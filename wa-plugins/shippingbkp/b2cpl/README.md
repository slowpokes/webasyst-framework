# Плагин расчета доставки компанией Директ-Сервис (B2CPL) для Shopscript-6

Плагин позволяет рассчитать стоимость доставки заказа по России через API курьерской службы Директ-Сервис (B2CPL).
Для расчета используется почтовый индекс получателя. Без индекса расчет не производится.
 
## Подключение к API

Для работы с API понадобятся идентификатор клиента и ключ к API, которые можно получить у менеджера курьерской службы.

### Тестовые параметры

Для тестирования работы плагина можно использовать идентификатор клиента *test* и ключ *test*. Расчет стоимости с использованием этих данных будет неполным. В качестве тестового идентификатора отправления для проверки трекинга можно использовать номер *94699931*.

## Выбор способов доставки для расчета и поля адреса

Плагин позволяет в настройках указать, для каких способов доставки нужно производить расчет. Можно выбрать один или несколько вариантов:

* ПВЗ (доставка в пункты выдачи заказов)
* Курьер (доставка курьером до двери)
* Почта России (отправка почтой с наложенным платежом через Директ-Сервис, если не хочется использовать штатный плагин Webasyst Framework/Shopscript)

Для всех способов расчета обязателен почтовый индекс. Также в контактных данных в поле "Страна" должно быть выбрано значение "Российская Федерация".

*Для ПВЗ* других полей не требуется.

*Для курьерской доставки* и *почты* требует полный адрес &mdash; регион, город, улица.

## Наценка к расчетной стоимости

К стоимости доставки, которая получена по запросу к API, можно добавить наценку. Укажите в поле "Стоимость комплектации"
размер наценки в рублях или процентах от расчетной стоимости доставки.

 * Если указать просто число, например "100", то наценка будет считаться фиксированной и сумме доставки будет добавлено
   100 рублей
 * Если указать число и после него поставить знак процент, например "30%", то наценка будет рассчитана как процент от
   расчетной **стоимости доставки**.

## Уточнение сроков доставки

Чтобы точнее показать покупателю срок доставки, к расчетному сроку доставки, полученному по API, можно добавить
указанное в настройке *"Срок комплектации"* число дней. Эта настройка поддерживает указание как точного числа, так и
диапазона. Например сервер по API ответил, что заказ будет доставлен 5 июня.

 * Если указать точное число дней, например, "2", то покупателю будет объявлено, что заказ будет доставлен 7 июня
 * Если указать диапазон, например "2-3", то покупателю будет также объявлен диапазон "7 июня - 8 июня"
 
Настройка *"Час переноса отгрузки"* позволяет добавить еще один день к сроку доставки (с учетом *"Срока комплектации"*)
тем заказам, которые оформляются позже указанного в настройке часа. Например, если все заказы, оформленные после
18 часов, начинают комплектоваться только на следующий день, можно добавить к сроку доставки еще 1 день. Укажите "0",
если нужно просто отключить эту настройку.

**Внимание!** для определения времени используются настройки сервера, на котором расположен магазин!

## Варианты установки

### Одна установка для всех способов

Этот вариант позволяет уменьшить количество пунктов при оформлении заказа, но делает обязательным заполнение полей
адреса даже при доставке до пункта выдачи заказов

### Несколько установок с разными конфигурациями

При этом варианте при оформлении заказа на этапе выбора доставки появляется несколько пунктов, но при выборе доставки
до ПВЗ *вводить поля адреса не потребуется*. А для конфигурации с доставкой курьером и/или почтой адрес указать придется.


