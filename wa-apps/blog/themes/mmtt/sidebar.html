<div class="sidebar blog_sidebar">
    {$month_year = array()}
    {$month_rus = array('Хуябрь', 'Январь', 'Февраль', 'Март', 'Апрель', 'Май', 'Июнь', 'Июль', 'Август', 'Сентябрь',
    'Октябрь', 'Ноябрь', 'Декабрь')}
    {$latest_posts = $wa->blog->posts()}
    {foreach $latest_posts as $p}
        {if !isset($month_year[$p.datetime|date_format:'Y'])}
            {$month_year[$p.datetime|date_format:'Y'] = array()}
        {/if}
        {if !isset($month_year[$p.datetime|date_format:'Y'][$p.datetime|date_format:'m'])}
            {$month_year[$p.datetime|date_format:'Y'][$p.datetime|date_format:'m'] = array()}
        {/if}
        {$month_year[$p.datetime|date_format:'Y'][$p.datetime|date_format:'m'][] = $p}
    {/foreach}
    <ul class="menu-v with-icons">
        {foreach $month_year as $key=>$month}
            <li class="closed">
                <i class="icon16 overhanging arrow"></i>
                <a href="#" class="sidebar_link"><i class="icon16 folder"></i> {$key}</a>
                <ul class="menu-v">
                    {foreach $month as $m}
                        <li class="closed">
                            <i class="icon16 overhanging arrow"></i>
                            <a href="#" class="sidebar_link"><i class="icon16 calendar"></i>{$month_rus[$m[0].datetime|date_format:'n']}</a>
                            <ul class="menu-v">
                                {foreach $m as $p}
                                    <li {if isset($post)&&($post.id==$p.id)}class="current" {/if}>
                                        <a href="{$p.link}"><i class="icon16 post"></i> {$p.title}</a>
                                    </li>
                                {/foreach}
                            </ul>
                        </li>
                    {/foreach}
                </ul>
            </li>
        {/foreach}
    </ul>
</div>

<script>
    openLink($(".blog_sidebar").find('.current'));
</script>