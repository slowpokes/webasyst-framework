(function(b){b.widget("ui.resizable",b.ui.mouse,{widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:1E3},_create:function(){var d=this,a=this.options;this.element.addClass("ui-resizable");b.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],
_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null});this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(/relative/.test(this.element.css("position"))&&b.browser.opera&&this.element.css({position:"relative",top:"auto",left:"auto"}),this.element.wrap(b('<div class="ui-wrapper" style="overflow: hidden;"></div>').css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),
this.element=this.element.parent().data("resizable",this.element.data("resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize",
"none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize());this.handles=a.handles||(b(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se");if(this.handles.constructor==String){"all"==
this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw");var c=this.handles.split(",");this.handles={};for(var f=0;f<c.length;f++){var h=b.trim(c[f]),k=b('<div class="ui-resizable-handle ui-resizable-'+h+'"></div>');/sw|se|ne|nw/.test(h)&&k.css({zIndex:++a.zIndex});"se"==h&&k.addClass("ui-icon ui-icon-gripsmall-diagonal-se");this.handles[h]=".ui-resizable-"+h;this.element.append(k)}}this._renderAxis=function(d){d=d||this.element;for(var a in this.handles){this.handles[a].constructor==String&&(this.handles[a]=
b(this.handles[a],this.element).show());if(this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)){var e=b(this.handles[a],this.element),c=0,c=/sw|ne|nw|se|n|s/.test(a)?e.outerHeight():e.outerWidth(),e=["padding",/ne|nw|n/.test(a)?"Top":/se|sw|s/.test(a)?"Bottom":/^e$/.test(a)?"Right":"Left"].join("");d.css(e,c);this._proportionallyResize()}b(this.handles[a])}};this._renderAxis(this.element);this._handles=b(".ui-resizable-handle",this.element).disableSelection();
this._handles.mouseover(function(){if(!d.resizing){if(this.className)var b=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i);d.axis=b&&b[1]?b[1]:"se"}});a.autoHide&&(this._handles.hide(),b(this.element).addClass("ui-resizable-autohide").hover(function(){b(this).removeClass("ui-resizable-autohide");d._handles.show()},function(){d.resizing||(b(this).addClass("ui-resizable-autohide"),d._handles.hide())}));this._mouseInit()},destroy:function(){this._mouseDestroy();var d=function(a){b(a).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};
if(this.elementIsWrapper){d(this.element);var a=this.element;a.after(this.originalElement.css({position:a.css("position"),width:a.outerWidth(),height:a.outerHeight(),top:a.css("top"),left:a.css("left")})).remove()}this.originalElement.css("resize",this.originalResizeStyle);d(this.originalElement);return this},_mouseCapture:function(a){var e=!1,c;for(c in this.handles)b(this.handles[c])[0]==a.target&&(e=!0);return!this.options.disabled&&e},_mouseStart:function(d){var e=this.options,c=this.element.position(),
f=this.element;this.resizing=!0;this.documentScroll={top:b(document).scrollTop(),left:b(document).scrollLeft()};(f.is(".ui-draggable")||/absolute/.test(f.css("position")))&&f.css({position:"absolute",top:c.top,left:c.left});b.browser.opera&&/relative/.test(f.css("position"))&&f.css({position:"relative",top:"auto",left:"auto"});this._renderProxy();var c=a(this.helper.css("left")),h=a(this.helper.css("top"));e.containment&&(c+=b(e.containment).scrollLeft()||0,h+=b(e.containment).scrollTop()||0);this.offset=
this.helper.offset();this.position={left:c,top:h};this.size=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()};this.originalSize=this._helper?{width:f.outerWidth(),height:f.outerHeight()}:{width:f.width(),height:f.height()};this.originalPosition={left:c,top:h};this.sizeDiff={width:f.outerWidth()-f.width(),height:f.outerHeight()-f.height()};this.originalMousePosition={left:d.pageX,top:d.pageY};this.aspectRatio="number"==typeof e.aspectRatio?e.aspectRatio:
this.originalSize.width/this.originalSize.height||1;e=b(".ui-resizable-"+this.axis).css("cursor");b("body").css("cursor","auto"==e?this.axis+"-resize":e);f.addClass("ui-resizable-resizing");this._propagate("start",d);return!0},_mouseDrag:function(b){var a=this.helper,c=this.originalMousePosition,f=this._change[this.axis];if(!f)return!1;c=f.apply(this,[b,b.pageX-c.left||0,b.pageY-c.top||0]);if(this._aspectRatio||b.shiftKey)c=this._updateRatio(c,b);c=this._respectSize(c,b);this._propagate("resize",
b);a.css({top:this.position.top+"px",left:this.position.left+"px",width:this.size.width+"px",height:this.size.height+"px"});!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize();this._updateCache(c);this._trigger("resize",b,this.ui());return!1},_mouseStop:function(a){this.resizing=!1;var e=this.options;if(this._helper){var c=this._proportionallyResizeElements,f=c.length&&/textarea/i.test(c[0].nodeName),c=f&&b.ui.hasScroll(c[0],"left")?0:this.sizeDiff.height,f={width:this.size.width-
(f?0:this.sizeDiff.width),height:this.size.height-c},c=parseInt(this.element.css("left"),10)+(this.position.left-this.originalPosition.left)||null,h=parseInt(this.element.css("top"),10)+(this.position.top-this.originalPosition.top)||null;e.animate||this.element.css(b.extend(f,{top:h,left:c}));this.helper.height(this.size.height);this.helper.width(this.size.width);this._helper&&!e.animate&&this._proportionallyResize()}b("body").css("cursor","auto");this.element.removeClass("ui-resizable-resizing");
this._propagate("stop",a);this._helper&&this.helper.remove();return!1},_updateCache:function(b){this.offset=this.helper.offset();c(b.left)&&(this.position.left=b.left);c(b.top)&&(this.position.top=b.top);c(b.height)&&(this.size.height=b.height);c(b.width)&&(this.size.width=b.width)},_updateRatio:function(b){var a=this.position,c=this.size,f=this.axis;b.height?b.width=c.height*this.aspectRatio:b.width&&(b.height=c.width/this.aspectRatio);"sw"==f&&(b.left=a.left+(c.width-b.width),b.top=null);"nw"==
f&&(b.top=a.top+(c.height-b.height),b.left=a.left+(c.width-b.width));return b},_respectSize:function(b){var a=this.options,g=this.axis,f=c(b.width)&&a.maxWidth&&a.maxWidth<b.width,h=c(b.height)&&a.maxHeight&&a.maxHeight<b.height,k=c(b.width)&&a.minWidth&&a.minWidth>b.width,l=c(b.height)&&a.minHeight&&a.minHeight>b.height;k&&(b.width=a.minWidth);l&&(b.height=a.minHeight);f&&(b.width=a.maxWidth);h&&(b.height=a.maxHeight);var n=this.originalPosition.left+this.originalSize.width,t=this.position.top+this.size.height,
u=/sw|nw|w/.test(g),g=/nw|ne|n/.test(g);k&&u&&(b.left=n-a.minWidth);f&&u&&(b.left=n-a.maxWidth);l&&g&&(b.top=t-a.minHeight);h&&g&&(b.top=t-a.maxHeight);(a=!b.width&&!b.height)&&!b.left&&b.top?b.top=null:a&&!b.top&&b.left&&(b.left=null);return b},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var a=this.helper||this.element,c=0;c<this._proportionallyResizeElements.length;c++){var g=this._proportionallyResizeElements[c];if(!this.borderDif){var f=[g.css("borderTopWidth"),
g.css("borderRightWidth"),g.css("borderBottomWidth"),g.css("borderLeftWidth")],h=[g.css("paddingTop"),g.css("paddingRight"),g.css("paddingBottom"),g.css("paddingLeft")];this.borderDif=b.map(f,function(b,a){b=parseInt(b,10)||0;a=parseInt(h[a],10)||0;return b+a})}b.browser.msie&&(b(a).is(":hidden")||b(a).parents(":hidden").length)||g.css({height:a.height()-this.borderDif[0]-this.borderDif[2]||0,width:a.width()-this.borderDif[1]-this.borderDif[3]||0})}},_renderProxy:function(){var a=this.options;this.elementOffset=
this.element.offset();if(this._helper){this.helper=this.helper||b('<div style="overflow:hidden;"></div>');var c=b.browser.msie&&7>b.browser.version,g=c?1:0,c=c?2:-1;this.helper.addClass(this._helper).css({width:this.element.outerWidth()+c,height:this.element.outerHeight()+c,position:"absolute",left:this.elementOffset.left-g+"px",top:this.elementOffset.top-g+"px",zIndex:++a.zIndex});this.helper.appendTo("body").disableSelection()}else this.helper=this.element},_change:{e:function(b,a){return{width:this.originalSize.width+
a}},w:function(b,a){return{left:this.originalPosition.left+a,width:this.originalSize.width-a}},n:function(b,a,c){return{top:this.originalPosition.top+c,height:this.originalSize.height-c}},s:function(b,a,c){return{height:this.originalSize.height+c}},se:function(a,c,g){return b.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[a,c,g]))},sw:function(a,c,g){return b.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[a,c,g]))},ne:function(a,c,g){return b.extend(this._change.n.apply(this,
arguments),this._change.e.apply(this,[a,c,g]))},nw:function(a,c,g){return b.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[a,c,g]))}},_propagate:function(a,c){b.ui.plugin.call(this,a,[c,this.ui()]);"resize"!=a&&this._trigger(a,c,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}});b.extend(b.ui.resizable,
{version:"1.8.2"});b.ui.plugin.add("resizable","alsoResize",{start:function(){var a=b(this).data("resizable").options,c=function(a){b(a).each(function(){b(this).data("resizable-alsoresize",{width:parseInt(b(this).width(),10),height:parseInt(b(this).height(),10),left:parseInt(b(this).css("left"),10),top:parseInt(b(this).css("top"),10)})})};"object"!=typeof a.alsoResize||a.alsoResize.parentNode?c(a.alsoResize):a.alsoResize.length?(a.alsoResize=a.alsoResize[0],c(a.alsoResize)):b.each(a.alsoResize,function(b){c(b)})},
resize:function(){var a=b(this).data("resizable"),c=a.options,g=a.originalSize,f=a.originalPosition,h={height:a.size.height-g.height||0,width:a.size.width-g.width||0,top:a.position.top-f.top||0,left:a.position.left-f.left||0},k=function(c,e){b(c).each(function(){var c=b(this),g=b(this).data("resizable-alsoresize"),f={};b.each((e&&e.length?e:["width","height","top","left"])||["width","height","top","left"],function(b,a){(b=(g[a]||0)+(h[a]||0))&&0<=b&&(f[a]=b||null)});/relative/.test(c.css("position"))&&
b.browser.opera&&(a._revertToRelativePosition=!0,c.css({position:"absolute",top:"auto",left:"auto"}));c.css(f)})};"object"!=typeof c.alsoResize||c.alsoResize.nodeType?k(c.alsoResize):b.each(c.alsoResize,function(b,a){k(b,a)})},stop:function(){var a=b(this).data("resizable");a._revertToRelativePosition&&b.browser.opera&&(a._revertToRelativePosition=!1,el.css({position:"relative"}));b(this).removeData("resizable-alsoresize-start")}});b.ui.plugin.add("resizable","animate",{stop:function(a){var c=b(this).data("resizable"),
g=c.options,f=c._proportionallyResizeElements,h=f.length&&/textarea/i.test(f[0].nodeName),k=h&&b.ui.hasScroll(f[0],"left")?0:c.sizeDiff.height,h={width:c.size.width-(h?0:c.sizeDiff.width),height:c.size.height-k},k=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null;c.element.animate(b.extend(h,l&&k?{top:l,left:k}:{}),{duration:g.animateDuration,easing:g.animateEasing,step:function(){var g=
{width:parseInt(c.element.css("width"),10),height:parseInt(c.element.css("height"),10),top:parseInt(c.element.css("top"),10),left:parseInt(c.element.css("left"),10)};f&&f.length&&b(f[0]).css({width:g.width,height:g.height});c._updateCache(g);c._propagate("resize",a)}})}});b.ui.plugin.add("resizable","containment",{start:function(){var c=b(this).data("resizable"),e=c.element,g=c.options.containment;if(e=g instanceof b?g.get(0):/parent/.test(g)?e.parent().get(0):g)if(c.containerElement=b(e),/document/.test(g)||
g==document)c.containerOffset={left:0,top:0},c.containerPosition={left:0,top:0},c.parentData={element:b(document),left:0,top:0,width:b(document).width(),height:b(document).height()||document.body.parentNode.scrollHeight};else{var f=b(e),h=[];b(["Top","Right","Left","Bottom"]).each(function(b,c){h[b]=a(f.css("padding"+c))});c.containerOffset=f.offset();c.containerPosition=f.position();c.containerSize={height:f.innerHeight()-h[3],width:f.innerWidth()-h[1]};var g=c.containerOffset,k=c.containerSize.height,
l=c.containerSize.width,l=b.ui.hasScroll(e,"left")?e.scrollWidth:l,k=b.ui.hasScroll(e)?e.scrollHeight:k;c.parentData={element:e,left:g.left,top:g.top,width:l,height:k}}},resize:function(a){var c=b(this).data("resizable"),g=c.options,f=c.containerOffset,h=c.position;a=c._aspectRatio||a.shiftKey;var k={top:0,left:0},l=c.containerElement;l[0]!=document&&/static/.test(l.css("position"))&&(k=f);h.left<(c._helper?f.left:0)&&(c.size.width+=c._helper?c.position.left-f.left:c.position.left-k.left,a&&(c.size.height=
c.size.width/g.aspectRatio),c.position.left=g.helper?f.left:0);h.top<(c._helper?f.top:0)&&(c.size.height+=c._helper?c.position.top-f.top:c.position.top,a&&(c.size.width=c.size.height*g.aspectRatio),c.position.top=c._helper?f.top:0);c.offset.left=c.parentData.left+c.position.left;c.offset.top=c.parentData.top+c.position.top;g=Math.abs(c.offset.left-k.left+c.sizeDiff.width);f=Math.abs((c._helper?c.offset.top-k.top:c.offset.top-f.top)+c.sizeDiff.height);h=c.containerElement.get(0)==c.element.parent().get(0);
k=/relative|absolute/.test(c.containerElement.css("position"));h&&k&&(g-=c.parentData.left);g+c.size.width>=c.parentData.width&&(c.size.width=c.parentData.width-g,a&&(c.size.height=c.size.width/c.aspectRatio));f+c.size.height>=c.parentData.height&&(c.size.height=c.parentData.height-f,a&&(c.size.width=c.size.height*c.aspectRatio))},stop:function(){var a=b(this).data("resizable"),c=a.options,g=a.containerOffset,f=a.containerPosition,h=a.containerElement,k=b(a.helper),l=k.offset(),n=k.outerWidth()-a.sizeDiff.width,
k=k.outerHeight()-a.sizeDiff.height;a._helper&&!c.animate&&/relative/.test(h.css("position"))&&b(this).css({left:l.left-f.left-g.left,width:n,height:k});a._helper&&!c.animate&&/static/.test(h.css("position"))&&b(this).css({left:l.left-f.left-g.left,width:n,height:k})}});b.ui.plugin.add("resizable","ghost",{start:function(){var a=b(this).data("resizable"),c=a.options,g=a.size;a.ghost=a.originalElement.clone();a.ghost.css({opacity:.25,display:"block",position:"relative",height:g.height,width:g.width,
margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof c.ghost?c.ghost:"");a.ghost.appendTo(a.helper)},resize:function(){var a=b(this).data("resizable");a.ghost&&a.ghost.css({position:"relative",height:a.size.height,width:a.size.width})},stop:function(){var a=b(this).data("resizable");a.ghost&&a.helper&&a.helper.get(0).removeChild(a.ghost.get(0))}});b.ui.plugin.add("resizable","grid",{resize:function(){var a=b(this).data("resizable"),c=a.options,g=a.size,f=a.originalSize,
h=a.originalPosition,k=a.axis;c.grid="number"==typeof c.grid?[c.grid,c.grid]:c.grid;var l=Math.round((g.width-f.width)/(c.grid[0]||1))*(c.grid[0]||1),c=Math.round((g.height-f.height)/(c.grid[1]||1))*(c.grid[1]||1);/^(se|s|e)$/.test(k)?(a.size.width=f.width+l,a.size.height=f.height+c):/^(ne)$/.test(k)?(a.size.width=f.width+l,a.size.height=f.height+c,a.position.top=h.top-c):(/^(sw)$/.test(k)?(a.size.width=f.width+l,a.size.height=f.height+c):(a.size.width=f.width+l,a.size.height=f.height+c,a.position.top=
h.top-c),a.position.left=h.left-l)}});var a=function(a){return parseInt(a,10)||0},c=function(a){return!isNaN(parseInt(a,10))}})(jQuery);/*
 (c) 2008-2009 Benjamin Arthur Lupton {@link http://www.balupton.com}
 @license GNU Affero General Public License - {@link http://www.gnu.org/licenses/agpl.html}
 @example Visit {@link http://jquery.com/plugins/project/jquery_history_bal} for more information.


 I would like to take this space to thank the following projects, blogs, articles and people:
 - jQuery {@link http://jquery.com/}
 - jQuery UI History - Klaus Hartl {@link http://www.stilbuero.de/jquery/ui_history/}
 - Really Simple History - Brian Dillard and Brad Neuberg {@link http://code.google.com/p/reallysimplehistory/}
 - jQuery History Plugin - Taku Sano (Mikage Sawatari) {@link http://www.mikage.to/jquery/jquery_history.html}
 - jQuery History Remote Plugin - Klaus Hartl {@link http://stilbuero.de/jquery/history/}
 - Content With Style: Fixing the back button and enabling bookmarking for ajax apps - Mike Stenhouse {@link http://www.contentwithstyle.co.uk/Articles/38/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps}
 - Bookmarks and Back Buttons {@link http://ajax.howtosetup.info/options-and-efficiencies/bookmarks-and-back-buttons/}
 - Ajax: How to handle bookmarks and back buttons - Brad Neuberg {@link http://dev.aol.com/ajax-handling-bookmarks-and-back-button}



 CHANGELOG

 v1.0.1-final, July 11, 2009
 - Restructured a little bit
 - Documented
 - Cleaned go/request

 v1.0.0-final, June 19, 2009
 - Been stable for over a year now, pushing live.

 v0.1.0-dev, July 24, 2008
 - Initial Release

*/
(function(b){"undefined"===typeof console&&(console="undefined"!==typeof window.console?window.console:{});console.log=console.log||function(){};console.debug=console.debug||console.log;console.warn=console.warn||console.log;console.error=console.error||function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);alert(a.join("\n"))};console.trace=console.trace||console.log;console.group=console.group||console.log;console.groupEnd=console.groupEnd||console.log;console.profile=console.profile||
console.log;console.profileEnd=console.profileEnd||console.log;b.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},format:function(a){return a=a.replace(/^.+?#/g,"").replace(/^#?\/?|\/?$/g,"")},getState:function(){return b.History.state},setState:function(a){var c=b.History;a=c.format(a);c.state=a;return c.state},getHash:function(){var a=parent&&!b.browser.msie?parent.window.location.hash:window.location.hash||location.hash;return a=b.History.format(a)},
setHash:function(a){a=b.History.format(a);a=a.replace(/^\/?|\/?(\?)|\/?$/g,"/$1");"undefined"===typeof window.location.hash&&(location.hash=a);b.browser.msie&&8>parseInt(b.browser.version,10)&&(b.History.$iframe.contentWindow.document.open(),b.History.$iframe.contentWindow.document.close())},go:function(a){var c=b.History;a=c.format(a);c.getHash()!==a?c.setHash(a):(c.setState(a),c.trigger());return!0},hashchange:function(a){var c=b.History;c.options.debug&&console.debug("History.hashchange",this,
arguments);var d=c.getHash(),e=c.getState();if(!c.$iframe&&e===d||c.$iframe&&c.hash===c.$iframe.contentWindow.document.location.hash||e===d)return!1;c.setState(d);c.trigger();return!0},bind:function(a,c){var d=b.History;c?("undefined"===typeof d.handlers.specific[a]&&(d.handlers.specific[a]=[]),d.handlers.specific[a].push(c)):d.handlers.generic.push(a);return!0},trigger:function(a){var c=b.History;"undefined"===typeof a&&(a=c.getState());var d,e,g,f;if("undefined"!==typeof c.handlers.specific[a])for(f=
c.handlers.specific[a],d=0,e=f.length;d<e;++d)g=f[d],g(a);f=c.handlers.generic;d=0;for(e=f.length;d<e;++d)g=f[d],g(a);return!0},construct:function(){var a=b.History;b(document).ready(function(){a.domReady()});return!0},configure:function(a){var c=b.History;c.options=b.extend(c.options,a);return!0},domReadied:!1,domReady:function(){var a=b.History;if(!a.domRedied)return a.domRedied=!0,a.$window=b(window),a.$window.bind("hashchange",this.hashchange),setTimeout(a.hashchangeLoader,200),!0},hashchangeLoader:function(){var a=
b.History;if(b.browser.msie&&8<=parseInt(b.browser.version))(c=a.getHash())&&a.$window.trigger("hashchange");else{if(b.browser.msie){a.$iframe=b('<iframe id="jquery-history-iframe" style="display: none;"></$iframe>').prependTo(document.body)[0];a.$iframe.contentWindow.document.open();a.$iframe.contentWindow.document.close();var c=a.getHash();c&&(a.$iframe.contentWindow.document.location.hash=c);c=function(){var b=a.format(a.$iframe.contentWindow.document.location.hash);a.getState()!==b&&a.setHash(a.$iframe.contentWindow.document.location.hash);
b=a.getHash();a.getState()!==b&&a.go(b)}}else c=function(){var b=a.getHash();a.getState()!==b&&a.go(b)};b.browser.msie&&8>parseInt(b.browser.version)?setInterval(c,1500):setInterval(c,200)}return!0}};b.History.construct()})(jQuery);(function(b){function a(a,c,d,g){g={data:g||(c?c.data:{}),_wrap:c?c._wrap:null,tmpl:null,parent:c||null,nodes:[],calls:k,nest:l,wrap:n,html:t,update:u};a&&b.extend(g,a,{nodes:[],parent:c});d&&(g.tmpl=d,g._ctnt=g._ctnt||g.tmpl(b,g),g.key=++v,(y.length?w:p)[v]=g);return g}function c(a,g,e){var f;e=e?b.map(e,function(b){return"string"===typeof b?a.key?b.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,'$1 _tmplitem="'+a.key+'" $2'):b:c(b,a,b._ctnt)}):a;if(g)return e;e=e.join("");e.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(a,c,g,e){f=b(g).get();h(f);c&&(f=d(c).concat(f));e&&(f=f.concat(d(e)))});return f?f:d(e)}function d(a){var c=document.createElement("div");c.innerHTML=a;return b.makeArray(c.childNodes)}function e(a){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+b.trim(a).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(a,c,d,g,e,h,m){a=b.tmpl.tag[d];if(!a)throw"Template command not found: "+d;d=a._default||[];h&&!/\w$/.test(e)&&(e+=h,h="");e?(e=f(e),m=m?","+f(m)+")":h?")":"",m=h?-1<e.indexOf(".")?e+h:"("+e+").call($item"+m:e,h=h?m:"(typeof("+e+")==='function'?("+e+").call($item):("+e+"))"):h=m=d.$1||"null";g=f(g);return"');"+a[c?"close":"open"].split("$notnull_1").join(e?"typeof("+e+")!=='undefined' && ("+e+")!=null":"true").split("$1a").join(h).split("$1").join(m).split("$2").join(g?g.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,
function(a,b,c,d){return(d=d?","+d+")":c?")":"")?"("+b+").call($item"+d:a}):d.$2||"")+"_.push('"})+"');}return _;")}function g(a,d){a._wrap=c(a,!0,b.isArray(d)?d:[A.test(d)?d:b(d).html()]).join("")}function f(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function h(c){function d(c){function e(b){b+=g;k=h[b]=h[b]||a(k,p[k.parent.key+g]||k.parent,null,!0)}var f,m=c,k,r;if(r=c.getAttribute("_tmplitem")){for(;m.parentNode&&1===(m=m.parentNode).nodeType&&!(f=m.getAttribute("_tmplitem")););
f!==r&&(m=m.parentNode?11===m.nodeType?0:m.getAttribute("_tmplitem")||0:0,(k=p[r])||(k=w[r],k=a(k,p[m]||w[m],null,!0),k.key=++v,p[v]=k),q&&e(r));c.removeAttribute("_tmplitem")}else q&&(k=b.data(c,"tmplItem"))&&(e(k.key),p[k.key]=k,m=(m=b.data(c.parentNode,"tmplItem"))?m.key:0);if(k){for(f=k;f&&f.key!=m;)f.nodes.push(c),f=f.parent;delete k._ctnt;delete k._wrap;b.data(c,"tmplItem",k)}}var g="_"+q,e,f,h={},k,l,n;k=0;for(l=c.length;k<l;k++)if(1===(e=c[k]).nodeType){f=e.getElementsByTagName("*");for(n=
f.length-1;0<=n;n--)d(f[n]);d(e)}}function k(a,b,c,d){if(!a)return y.pop();y.push({_:a,tmpl:b,item:this,data:c,options:d})}function l(a,c,d){return b.tmpl(b.template(a),c,d,this)}function n(a,c){var d=a.options||{};d.wrapped=c;return b.tmpl(b.template(a.tmpl),a.data,d,a.item)}function t(a,c){var d=this._wrap;return b.map(b(b.isArray(d)?d.join(""):d).filter(a||"*"),function(a){if(c)a=a.innerText||a.textContent;else{var b;(b=a.outerHTML)||(b=document.createElement("div"),b.appendChild(a.cloneNode(!0)),
b=b.innerHTML);a=b}return a})}function u(){var a=this.nodes;b.tmpl(null,null,null,this).insertBefore(a[0]);b(a).remove()}var z=b.fn.domManip,A=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,p={},w={},x,B={key:0,data:{}},v=0,q=0,y=[];b.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,c){b.fn[a]=function(d){var e=[];d=b(d);var g,f,h;g=1===this.length&&this[0].parentNode;x=p||{};if(g&&11===g.nodeType&&1===g.childNodes.length&&1===d.length)d[c](this[0]),
e=this;else{f=0;for(h=d.length;f<h;f++)q=f,g=(0<f?this.clone(!0):this).get(),b.fn[c].apply(b(d[f]),g),e=e.concat(g);q=0;e=this.pushStack(e,a,d.selector)}d=x;x=null;b.tmpl.complete(d);return e}});b.fn.extend({tmpl:function(a,c,d){return b.tmpl(this[0],a,c,d)},tmplItem:function(){return b.tmplItem(this[0])},template:function(a){return b.template(a,this[0])},domManip:function(a,c,d){if(a[0]&&a[0].nodeType){for(var e=b.makeArray(arguments),g=a.length,f=0,h;f<g&&!(h=b.data(a[f++],"tmplItem")););1<g&&(e[0]=
[b.makeArray(a)]);h&&q&&(e[2]=function(a){b.tmpl.afterManip(this,a,d)});z.apply(this,e)}else z.apply(this,arguments);q=0;!x&&b.tmpl.complete(p);return this}});b.extend({tmpl:function(d,e,f,h){var k=!h;if(k)h=B,d=b.template[d]||b.template(null,d),w={};else if(!d)return d=h.tmpl,p[h.key]=h,h.nodes=[],h.wrapped&&g(h,h.wrapped),b(c(h,null,h.tmpl(b,h)));if(!d)return[];"function"===typeof e&&(e=e.call(h||{}));f&&f.wrapped&&g(f,f.wrapped);e=b.isArray(e)?b.map(e,function(b){return b?a(f,h,d,b):null}):[a(f,
h,d,e)];return k?b(c(h,null,e)):e},tmplItem:function(a){var c;for(a instanceof b&&(a=a[0]);a&&1===a.nodeType&&!(c=b.data(a,"tmplItem"))&&(a=a.parentNode););return c||B},template:function(a,c){return c?("string"===typeof c?c=e(c):c instanceof b&&(c=c[0]||{}),c.nodeType&&(c=b.data(c,"tmpl")||b.data(c,"tmpl",e(c.innerHTML))),"string"===typeof a?b.template[a]=c:c):a?"string"!==typeof a?b.template(null,a):b.template[a]||b.template(null,A.test(a)?a:b(a)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});
b.extend(b.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},
open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(){p={}},afterManip:function(a,c,d){var e=11===c.nodeType?b.makeArray(c.childNodes):1===c.nodeType?[c]:[];d.call(a,c);h(e);q++}})})(jQuery);jQuery.cookie=function(b,a,c){if(1<arguments.length&&(null===a||"object"!==typeof a)){c=jQuery.extend({},c);null===a&&(c.expires=-1);if("number"===typeof c.expires){var d=c.expires,e=c.expires=new Date;e.setDate(e.getDate()+d)}return document.cookie=[encodeURIComponent(b),"=",c.raw?String(a):encodeURIComponent(String(a)),c.expires?"; expires="+c.expires.toUTCString():"",c.path?"; path="+c.path:"",c.domain?"; domain="+c.domain:"",c.secure?"; secure":""].join("")}c=a||{};e=c.raw?function(a){return a}:
decodeURIComponent;return(d=(new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)")).exec(document.cookie))?e(d[1]):null};$.wa=$.ui?$.extend(!0,$.wa,$.ui):{};
$.wa=$.extend(!0,$.wa,{data:{},get:function(b,a){return void 0==b?this.data:this.data[name]||a||null},set:function(b,a){if(void 0==b)return this.data;"object"==typeof b?$.extend(this.data,b):this.data[b]=value;return this.data},encodeHTML:function(b){return b&&(""+b).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},decodeHTML:function(b){return b.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">")},setHash:function(b){b instanceof String||!b.toString||(b=b.toString());
b=b.replace(/\/\//g,"/");b=b.replace(/^.*#/,"");$.browser&&$.browser.safari?parent?parent.window.location=parent.window.location.href.replace(/#.*/,"")+"#"+b:window.location=location.href.replace(/#.*/,"")+"#"+b:!parent||$.browser&&$.browser.msie?location.hash=b:parent.window.location.hash=b;return!0},back:function(b){2<history.length?"number"==typeof b&&parseInt(b)==b?history.go(-b):history.go(-1):$.browser.msie&&0<history.length?history.back():b&&this.setHash(b);return!1},toggleHashParam:function(b){-1==
location.hash.search(b)?this.addToHash(b):this.removeFromHash(b)},addToHash:function(b){var a=location.hash;-1==a.search(b)&&(a+="/"+b+"/");this.setHash(a)},removeFromHash:function(b){var a=location.hash;-1<a.search(b)&&(a=a.replace(b,""));this.setHash(a)},setTitle:function(b){document.title=b},array_search:function(b,a,c){c=!!c;for(var d in a)if(c&&a[d]===b||!c&&a[d]==b)return d;return!1},dialogCreate:function(b,a){a=$.extend({content:'<h1>Loading... <i class="icon16 loading"></i></h1>',buttons:null,
url:null,post:null,small:!1,onload:null,oncancel:null},a);a.content=$(a.content);a.buttons=a.buttons?$(a.buttons):$('<input type="submit" class="button gray" value="'+$_("Cancel")+'">').click(function(){a.oncancel&&a.oncancel.call(c[0]);$.wa.dialogHide()});var c=$("#"+b);0>=c.size()&&(c=$('<div class="dialog" id="'+b+'" style="display: none"><div class="dialog-background"></div><div class="dialog-window"><div class="dialog-content"><div class="dialog-content-indent"></div></div><div class="dialog-buttons"><div class="dialog-buttons-gradient"></div></div></div></div>').appendTo("body"));
c.find(".dialog-buttons-gradient").empty().append(a.buttons);c.find(".dialog-content-indent").empty().append(a.content);c.show();a.small?c.addClass("small"):c.removeClass("small");if(a.url){var d=function(b){c.find(".dialog-content-indent").html(b);$.wa.waCenterDialog(c);a.onload&&a.onload.call(c[0])};a.post?$.post(a.url,a.post,d):$.get(a.url,d)}this.waCenterDialog(c);var e=function(b){if(c.is(":visible"))if(b&&27==b.keyCode)a.oncancel&&"function"==typeof a.oncancel&&a.oncancel.call(c[0]),$.wa.dialogHide();
else $(document).one("keyup",e)};e();$(document).one("hashchange",$.wa.dialogHide);return c},waCenterDialog:function(b){b=$(b);b=b.find(".dialog-window");var a=b.outerWidth(!0),c=b.outerHeight(!0),d=$(window).width(),e=$(window).height(),c=(e-c)/2/e;b.css({left:Math.round((d-a)/2/d*100)+"%",top:Math.round(100*c)+"%"})},dialogHide:function(){$(".dialog").hide();return!1},dropdownsClose:function(){var b=$(".dropdown:not(.disabled)");b.addClass("disabled");setTimeout(function(){b.removeClass("disabled")},
600)},dropdownsCloseEnable:function(){$(document).on("click",".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsCloseDisable:function(){$(document).off("click",".dropdown:not(.disabled)",this.dropdownsClickHandler)},dropdownsClickHandler:function(b){var a=$(this);a.hasClass("no-click-close")||(a.addClass("disabled"),setTimeout(function(){a.removeClass("disabled")},600))},defaultInputValue:function(b,a,c){b instanceof jQuery||(b=$(b));var d=function(){var d=b.val();d&&d!=a||(b.val(a),
b.addClass(c))};d();b.blur(d);b.focus(function(){b.hasClass(c)&&(b.removeClass(c),b.val(""))})},util:{formatFileSize:function(b){var a=-1;do b/=1024,a++;while(99<b);return Math.max(b,.01).toFixed(2)+(0<=a?" "+$_("kB MB GB TB PB EB".split(" ")[a]):"")}}});
$(document).ajaxError(function(b,a,c,d){if(200!==a.status&&a.responseText){if(!$.wa.errorHandler||$.wa.errorHandler(a))-1!=a.responseText.indexOf("Exception")?$.wa.dialogCreate("ajax-error",{content:"<div>"+a.responseText+"</div>"}):(document.open("text/html"),document.write(a.responseText),document.close(),$(window).one("hashchange",function(){window.location.reload()}))}else a.getResponseHeader("wa-session-expired")?window.location.reload():"undefined"!==typeof a.responseText&&-1!=a.responseText.indexOf("Exception")&&
$.wa.dialogCreate("ajax-error",{content:"<div>"+a.responseText+"</div>"})});$.ajaxSetup({cache:!1});$(document).ajaxSend(function(b,a,c){"POST"==c.type&&(b=(b=document.cookie.match(/(?:^|; )_csrf=([^;]*)/))?decodeURIComponent(b[1]):"",null===c.data&&(c.data=""),"string"==typeof c.data?-1==c.data.indexOf("_csrf=")&&(c.data+=(0<c.data.length?"&":"")+"_csrf="+b,a.setRequestHeader("Content-type","application/x-www-form-urlencoded")):"object"==typeof c.data&&(c.data._csrf=b))});
Array.prototype.indexOf||(Array.prototype.indexOf=function(b,a){var c=this.length,d=Number(a)||0,d=0>d?Math.ceil(d):Math.floor(d);for(0>d&&(d+=c);d<c;d++)if(d in this&&this[d]===b)return d;return-1});$.wa.locale=$.wa.locale||{};
$_=function(b,a){if(a){if(!$.wa.locale[a])return console&&console.log("Localization failed: "+a),a;if("string"==typeof $.wa.locale[a])return $.wa.locale[a];var c=b%10;return 1==Math.floor(b/10)%10||4<c||0==c?$.wa.locale[a][2]:1==c?$.wa.locale[a][0]:$.wa.locale[a][1]}if($.wa.locale[b])return"string"==typeof $.wa.locale[b]?$.wa.locale[b]:$.wa.locale[b][0];console&&console.log("Localization failed: "+b);return b};(function(b){b.ui.ddmanager.drop=function(a,c){var d=!1;b.each(b.ui.ddmanager.droppables[a.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&b.ui.intersect(a,this,this.options.tolerance)&&(d=this._drop.call(this,c)),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],a.currentItem||a.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,c)))});return d};b.wa.stickiescontroller={debug:!1,currentLayout:null,stickResizeTimer:{},stickResizeSign:{},
stickFontSize:{},stickContentLength:{},stick:{},maxZIndex:0,stickZIndex:{},_border:{height:18,width:4},_margin:{left:20,top:20,right:20,bottom:20},_size:{min_width:100,min_height:100,max_width:400,max_height:400},options:{default_background:""},init:function(a){var c=this;if("undefined"!=typeof b.History){b.History.bind(function(a){c.dispatch(a)});a=parent?parent.window.location.hash:location.hash;var d=Math.max(0,parseInt(b.cookie("stickies.current_sheet")));2>a.length?0<d?b.wa.setHash("#/sheet/"+
d):this.defaultAction():b.wa.setHash(a)}default_background&&(c.options.default_background=default_background);b("textarea.sticky-content").live("keyup change focus",function(a){var d=parseInt(b(this).attr("id").match(/\d+$/));if(d){if(c.updateZIndex(d),"focus"!=a.type){var e=b(this).attr("timestamp");e||(b(this).attr("timestamp",a.timeStamp),e=a.timeStamp);"change"==a.type||1E4<a.timeStamp-e?(c.updateFontSize(d,!0),c.stickyModifyAction({content:b(this).val(),id:d,timestamp:a.timeStamp}),b(this).attr("timestamp",
a.timeStamp)):c.stickContentLength[d]!=b(this).val().length&&(c.updateFontSize(d,!1),b("#sticky_status_"+d).removeClass("saved process").addClass("nosaved"))}}else c.log("Invalid sticky id:",b(this).attr("id"))});b(".js-form-submit").live("submit",function(){var a=b(this).attr("action").replace(/^.*#\/?/,"");c.dispatch(a);return!1});b(".js-form-submit input:reset").live("click",function(){var a=b(this).attr("src").replace(/^.*#\/?/,"");c.dispatch(a);return!1});b(".sticky").live("click",function(a){(a=
parseInt(b(this).attr("id").match(/\d+$/)))?c.updateZIndex(a):c.log("Invalid sticky id:",b(this).attr("id"))});b(".js-menu-item").live("click",function(){var a=b(this).attr("href").replace(/^.*#\/?/,"");b(this).hasClass("js-menu-no-proceed")?c.dispatch(a):b.wa.setHash("#/"+a);return!1});b(".js-sheet-item").live("mouseover",function(){0==b(".stickies-settings-form:visible").size()&&b("#wa-app-stickies-sheets").sortable("option","disabled")&&b("#wa-app-stickies-sheets").sortable("enable");return!0});
b("div#stickies-sheets").droppable({accept:".sticky",tolerance:"pointer",scope:"sheet",over:function(a,c){var d=b(c.draggable);d.resizable("destroy").find("div.sticky-inner").hide();0==d.find(".clone-head").size()?d.find("div.sticky-header").clone().addClass("clone-head").appendTo(c.draggable):d.find(".clone-head").show();if(!d.data("isOut")){var e=d.data("draggable");e.helperProportions={width:d.find(".clone-head").width(),height:d.find(".clone-head").height()};e._setContainment();d.data("isOver",
!0)}},out:function(a,d){var e=b(d.draggable);if(0!=e.find(".clone-head").size()&&(e.find(".clone-head").hide(),e.data("isOut"))){var k=e.data("draggable");k.helperProportions={width:e.width(),height:e.height()};k._setContainment();e.data("isOver",null)}e.find("div.sticky-inner").show();c.makeStickResizable(d.draggable)},drop:function(a,b){return!0}});b("body").click(function(a){0==b(".sticky").find(a.target).size()&&c.updateZIndexAllBlur()});b(window).unload(function(){c.checkChanges()});var e=/<\\\/(\w+)/g;
b("script[type$='x-jquery-tmpl']").each(function(){var a=b(this).attr("id").replace(/-template-js$/,"");try{var c=b(this).html().replace(e,"</$1");b.template(a,c)}catch(d){"object"==typeof console&&console.log(d)}})},dispatch:function(a){if(a)if(a=a.replace(/^.*#/,""),a=a.split("/"),a[0]){var b="",d=a.length,e;for(e in a){var g=a[e];if(2>e)if(0==e)b=g;else if(g.match(/[a-z]+/i))b+=g.substr(0,1).toUpperCase()+g.substr(1);else{d=e;break}else{d=e;break}}a=a.slice(d);this.execute(b,a)}else this.defaultAction();
else this.defaultAction()},execute:function(a,c){this.trace("execute",[a,c]);this[a+"Action"]?(this.currentAction=a,this.currentActionAttr=c,this[a+"Action"](c)):(this.log("Invalid action name:",a+"Action"),b.wa.setHash("#"),this.dispatch("#"))},checkChanges:function(){var a=this;b(".sticky-status.nosaved").each(function(c){c=parseInt(b(this).attr("id").match(/\d+$/));a.trace("force save",c);b("#sticky_content_"+c).change()})},defaultAction:function(){this.sheetAction(-1)},sheetAddAction:function(a){var c=
this;this.sendRequest("?module=sheet&action=add",null,function(a){b.tmpl("sheet",{sheet:a,current_sheet_id:!1}).insertBefore("#wa-app-stickies-sheets .top-padded");c.makeSticksTransferable(b("#sheet_item_"+a.id));b.wa.setHash("#/sheet/"+a.id)})},sheetAction:function(a){a=parseInt(a);var c=this;this.checkChanges();return this.sendRequest("?module=sheet",{sheet_id:a},function(a){c.drawSheet(a);var e=new Date;e.setDate(e.getDate()+30);!a.current_sheet_id&&a.default_sheet_id?(b.wa.setHash("#/sheet/"+
a.default_sheet_id),b.cookie("stickies.current_sheet",a.default_sheet_id,{expires:e})):a.current_sheet_id&&b.cookie("stickies.current_sheet",a.current_sheet_id,{expires:e});a.current_sheet&&b("title").html((a.current_sheet.name.split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")||"&lt;"+"no name".translate()+"&gt;")+" &mdash; "+accountName);a.current_sheet_add&&(c.sheetEditAction(a.current_sheet_id),b(".stickies-sidebar-scrolable").scrollTop(1E4))})},
sheetEditAction:function(a){this.checkChanges();this.trace("sheetEditAction",a);b("#sheet_item_"+parseInt(a)+" .stickies-settings-form").toggle(0);b("#sheet_item_"+parseInt(a)+" .stickies-settings-form").is(":visible")?b("#sheet_item_"+parseInt(a)).parent().sortable("disable"):b("#sheet_item_"+parseInt(a)).parent().sortable("enable")},sheetBackgroundAction:function(a){var c=parseInt(a[0]),d="";a[1]&&(d=a[1]);b("#stickies").attr("class",d);b("#background-vars-"+c+" li.selected").removeClass("selected");
b("#background-vars-"+c+"-"+d).addClass("selected")},sheetSaveAction:function(a){var c=parseInt(a),d=b("#sheet_item__settings_"+c).serializeArray();d.push({sheet_id:c,name:"background_id",value:b("#stickies").attr("class")});this.sendRequest("?module=sheet&action=save",d,function(d){b("#sheet_item_"+parseInt(a)+" .stickies-settings-form").toggle(0);""==d.name&&(d.name="&lt;"+"no name".translate()+"&gt;");b("#sheet_item_name_"+c).html(d.name.split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;"));
b("title").html(d.name.split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")+" &mdash; "+accountName)})},sheetSortAction:function(a,b,d){var e=this;this.sendRequest("?module=sheet&action=sort",{id:a,after_id:b},function(a){e.trace("SortAction result",a);a.error&&(e.error("Error occurred while sorting boards".translate(),"error"),d.sortable("cancel"))},function(a){e.log("SortAction cancel",{data:a,before:e.sheetsOrder,after:params});d.sortable("cancel");
e.error("Error occurred while sorting boards".translate(),"error");e.sheetAction(null)})},sheetDeleteAction:function(a){if(0==b("#wa-app-stickies-stickies div.sticky").length||1==confirm("Delete board with all stickies?".translate())){a=parseInt(a);var c=this;this.sendRequest("?module=sheet&action=delete",{sheet_id:a},function(a){a.sheet_id&&c.sheetAction(-1)})}},stickyModifyAction:function(a,c){var d=b("#sticky_"+a.id+" .sticky-status");d.removeClass("saved nosaved").addClass("process");void 0==
a.content&&(a.content=b("#sticky_"+a.id+" :input[name=content]").val());void 0==a.font_size&&b("#sticky_"+a.id+" :input[name=content]").size()&&(a.font_size=b("#sticky_"+a.id+" :input[name=content]").css("font-size").replace(/px/i,""));this.sendRequest("?module=sticky&action=modify",a,function(){d.removeClass("process nosaved").addClass("saved");d.text("");a.timestamp&&b("#sticky_"+a.id+" .stick_content").attr("timestamp",a.timestamp);"function"==typeof c&&c()},function(){d.removeClass("process nosaved").addClass("nosaved");
var a="Saving error".translate();d.text(" "+a)})},stickyAddAction:function(a){var c=this;this.sendRequest("?module=sticky&action=add",{sheet_id:a[0]},function(a){c.drawStick(a);c.makeStickDraggable("#sticky_"+a.id,{width:a.size_width,height:a.size_height});b("#sticky_"+a.id).find("textarea").focus()})},stickySettingsAction:function(a){a=parseInt(a);b("#sticky-settings-"+a).length?this.hideStickSettings(a):this.drawStickSettings(a)},stickySizeAction:function(a){},stickyColorAction:function(a){var c=
parseInt(a[0]);a=a[1];var d="sticky";a&&(d+=" sticky-"+a);b("#color-vars-"+c+" li.selected").removeClass("selected");b("#color-vars-"+c+"-"+a).addClass("selected");b("#sticky_"+c).attr("class",d);this.hideStickSettings(c);this.stickyModifyAction({id:c,color:a})},stickyDeleteAction:function(a){var c=this,d=parseInt(a),d={id:d,sheet_id:b("#sticky_"+d+" :input[name=sheet_id]").val()};this.sendRequest("?module=sticky&action=delete",d,function(d){d=parseInt(a[0]);b(".stick-position-"+d).remove();c.stick[d]=
null})},updateFontSize:function(a,c,d){var e="paddingTop paddingRight paddingBottom paddingLeft fontSize fontFamily fontWeight".split(" ");a=b("#sticky_"+a+" .sticky-content:input[name=content]");c=a.val().replace(/&/g,"&amp;").replace(/  /g,"&nbsp;").replace(/<|>/g,"&gt;").replace(/\n/g,"<br />");if(0!=c.length){$twin=a.parent().find("div.twin");if(0==$twin.length){$twin=b('<div class="twin"/>').css({position:"absolute","word-wrap":"break-word",display:"none",border:"1px solid #ccc"});for(var g=
e.length;g--;)$twin.css(e[g].toString(),a.css(e[g].toString()));$twin.appendTo(a.parent())}$twin.css("width",a.width());g=$twin.html().replace(/<br>/ig,"<br />");$twin.html(c+"&nbsp;");var e=a.height(),f=a.css("font-size").replace(/px/i,"");if(!(!d&&c+"&nbsp;"==g||$twin.height()<e&&16<=f||$twin.height()>e&&4>=f)){for(d=4;16>d;d+=1)if($twin.css("font-size",d),$twin.height()>e){--d;$twin.css("font-size",d);break}a.css("font-size",d);this.trace("updateFontSize",d);a.css("lineHeight",$twin.css("lineHeight"))}}},
updateZIndex:function(a){var c=b("#sticky_"+a);(this.stickZIndex[a]||Math.max(1,parseInt(c.css("z-index"))))<this.maxZIndex&&(c.css("z-index",++this.maxZIndex),this.stickZIndex[a]=this.maxZIndex,b("div.sticky-inner.active").removeClass("active"),b("#sticky_"+a+" div.sticky-inner").addClass("active"))},updateZIndexAllBlur:function(){b("div.sticky-inner.active").removeClass("active");this.maxZIndex++},drawSheet:function(a){b("#wa-app-stickies-sheets").empty();b("#wa-app-stickies-stickies").empty();
b("#wa-app-stickies-add").empty();a.current_sheet&&(b("#stickies").attr("class",a.current_sheet.background_id||this.options.default_background),b.tmpl("add-sticky",{sheet_id:a.current_sheet_id}).appendTo("#wa-app-stickies-add"));this.sheetsOrder=[];this.maxZIndex=0;this.stickFontSize=[];this.stickContentLength=[];this.stick=null;this.stick=[];for(sheet_id in a.sheets)"indexOf"!=sheet_id&&(this.sheetsOrder.push(parseInt(a.sheets[sheet_id].id)),b.tmpl("sheet",{sheet:a.sheets[sheet_id],current_sheet_id:a.current_sheet_id}).appendTo("#wa-app-stickies-sheets"));
b.tmpl("sheet-add",{}).appendTo("#wa-app-stickies-sheets");var c={};for(id in a.stickies)this.drawStick(a.stickies[id]),c[a.stickies[id].id]=a.stickies[id];this.makeSheetsSortable("#wa-app-stickies-sheets");this.makeSticksTransferable(b("#wa-app-stickies-sheets .js-sheet-item").not(".selected"));var d=this;b("div.sticky").each(function(a){a=parseInt(b(this).attr("id").match(/\d+$/));d.makeStickDraggable("#sticky_"+a,{width:b(this).width(),height:b(this).height()});c[a]&&0!=c[a].font_size||0!=c[a].content.length&&
d.updateFontSize(a,!0)})},drawStick:function(a){"undefined"!=typeof a.id&&(this.stickZIndex[a.id]=this.maxZIndex,$contener1=b(".stick-containment").length?b(".stick-containment"):b("<div />").addClass("stick-containment").css({position:"absolute",display:"block",left:"20px",top:"20px",right:"20px",bottom:"20px"}).appendTo("#wa-app-stickies-stickies"),$contener2=b("<div />").addClass("stick-position-"+a.id).css({position:"absolute",display:"block",left:"0",top:"0",right:a.size_width+"px",bottom:a.size_height+
"px"}).appendTo($contener1),a.position_left/=100,a.position_top/=100,b.tmpl("sticky",{sticky:a,zindex:++this.maxZIndex}).appendTo($contener2))},drawStickSettings:function(a){var c=b("#sticky_"+a).attr("class").match(/sticky-(\w+)/),c=c?c[1]:"",d=b("#sticky_"+a+" .sticky-content"),e=d.height(),g=d.width(),d=Math.max(e,g);b.tmpl("sticky-settings",{sticky:{id:a,color:c,size:d}}).appendTo("#sticky_"+a+" .sticky-inner");b("#sticky_"+a+" .sticky-content").hide("fast",function(){b("#sticky_"+a+" .sticky-inner").addClass("sticky-back");
b("#sticky-settings-"+a).show().height(e).width(g)})},hideStickSettings:function(a){var c=this;b("#sticky-settings-"+a).hide("fast",function(){b("#sticky_"+a+" .sticky-inner").removeClass("sticky-back");b("#sticky_"+a+" .sticky-content").show();b("#sticky-settings-"+a).remove();c.updateFontSize(a,!1)})},makeSheetsSortable:function(a){var c=this;b(a).sortable({containment:"#stickies-events",items:"li.js-sheet-item",axis:"y",distance:5,containment:"parent",cursor:"move",start:function(a,b){},update:function(a,
e){var g=parseInt(b(e.item).attr("id").match(/\d+$/)),f=b(e.item).prev().attr("id"),f=void 0===f?0:parseInt(f.match(/\d+$/));c.sheetSortAction(g,f,b(this))}})},makeStickDraggable:function(a,c){var d=this;b(a).each(function(){b(this).draggable({start:function(a,c){var f=parseInt(b(this).attr("id").match(/\d+$/));b("#sticky_status_"+f).removeClass("saved process").addClass("nosaved");d.updateZIndex(f)},stop:function(a,c){if(b(c.helper).data("draggable"))d.onStickDragableStop(a,c,b(this))},scroll:!1,
scope:"sheet",containment:".stick-containment",zindex:10001,cusrsor:"move",handle:"div.sticky-header"})});d.makeStickResizable(a)},makeStickResizable:function(a){var c=this;b(a).resizable({maxHeight:this._size.max_height+this._border.height,maxWidth:this._size.max_width+this._border.width,minHeight:this._size.min_height+this._border.height,minWidth:this._size.min_width+this._border.width,ghost:!0,stop:function(a,e){var g=parseInt(b(this).attr("id").match(/\d+$/));c.onResizeHandler(g,e.size.width,
e.size.height)}})},makeSticksTransferable:function(a){var c=this;b(a).droppable({accept:".sticky",hoverClass:"ui-state-active",tolerance:"pointer",scope:"sheet",drop:function(a,e){var g=parseInt(b(this).attr("id").match(/\d+$/)),f=parseInt(e.draggable.attr("id").match(/\d+$/));c.trace("drop",[f,a.target]);c.onStickDrop(f,g)}})},onStickDrop:function(a,c){b("#sticky_"+a).draggable({revert:!0});this.stickyModifyAction({id:a,sheet_id:c},function(d){b("#sticky_"+a).draggable("destroy");b("#sticky_"+a).remove();
d=b("#sheet_item_"+c+" .count");d.text(parseInt(d.text())+1)},function(){b("#sticky_"+a).draggable("option","disabled",!1)})},onResizeHandler:function(a,c,d){b(".stick-position-"+a).css({right:c+"px",bottom:d+"px"});b("#size-vars-"+a+" li.selected").removeClass("selected");b("#size-vars-"+a+"-"+c).addClass("selected");b("#sticky_"+a).height(d).width(c);b("#sticky_"+a+" .sticky-content").height(d-this._border.height).width(c-this._border.width);b("#sticky-settings-"+a).height(d).width(c);var e=this.stickCalculatePosition(b("#sticky_"+
a));c={drag:!0,id:a,size_width:c,size_height:d,position_left:100*e.left_procent,position_top:100*e.top_procent};this.trace("resize",c);this.updateFontSize(a,!1,!0);this.updateZIndex(a);this.stickyModifyAction(c)},stickCalculatePosition:function(a){this.trace("stickCalculatePosition");var b=a.parent(),d=100*parseInt(a.css("left"))/parseInt(b.width()),b=100*parseInt(a.css("top"))/parseInt(b.height());a.css("left",d+"%");a.css("top",b+"%");return{left_procent:d,top_procent:b}},onStickDragableStop:function(a,
c,d){(a=parseInt(d.attr("id").match(/\d+$/)))?(d=b(d),d=this.stickCalculatePosition(d),this.stickyModifyAction({drag:!0,id:a,position_left:100*d.left_procent,position_top:100*d.top_procent})):this.log("Invalid sticky id:",d.attr("id"))},sendRequest:function(a,c,d,e){var g=this;return b.ajax({url:a,data:c||{},type:"POST",dataType:"text",success:function(a,c,k){try{a=b.parseJSON(a)}catch(l){g.log("Invalid server JSON responce",l),"function"==typeof e&&e(),g.error("Invalid server responce".translate()+
"<br>"+l,"error")}if(a)switch(a.status){case "fail":g.error(a.errors.error||a.errors,"error");"function"==typeof e&&e(a);break;case "ok":"function"==typeof d&&d(a.data);break;default:g.log("unknown status responce",a.status),"function"==typeof e&&e(a)}else g.log("empty responce",c),"function"==typeof e&&e(),g.error("Empty server responce".translate(),"warning")},error:function(a,b,c){g.log("AJAX request error",b);"function"==typeof e&&e();g.error("AJAX request error".translate(),"warning")}})},error:function(a,
c){var d=b("#wa-system-notice");if(d){var e=1500;switch(c){case "error":e=6E3;a='<i class="icon16 bug"></i>'+a;break;case "warning":a='<i class="icon16 no"></i>'+a}d.html(a);d.slideDown().delay(e).slideUp()}else alert(a)},log:function(a,b){console&&console.log(a,b)},trace:function(a,b){console&&this.debug&&console.log(a,b)}}})(jQuery);var translate={};String.prototype.translate=function(){return translate[this]?translate[this]:this};
//# sourceMappingURL=wa.stickiescontroller.min.js.map