function currency_format(e, t) {
    var a, i, r, c, s, d = currency.frac_digits, o = currency.decimal_point, n = currency.thousands_sep;
    isNaN(d = Math.abs(d)) && (d = 2), void 0 == o && (o = ","), void 0 == n && (n = "."), a = parseInt(e = (+e || 0).toFixed(d)) + "", (i = a.length) > 3 ? i %= 3 : i = 0, s = i ? a.substr(0, i) + n : "", r = a.substr(i).replace(/(\d{3})(?=\d)/g, "$1" + n), c = d && e - a ? o + Math.abs(e - a).toFixed(d).replace(/-/, 0).slice(2) : "";
    var e = s + r + c, p = t ? currency.sign : currency.sign_html;
    return currency.sign_position ? e + currency.sign_delim + p : p + currency.sign_delim + e
}
$(".number_down").click(function () {
    var e = $("input.product-quantity"), t = parseInt(e.val()) - 1;
    return t = 1 > t ? 1 : t, e.val(t), e.change(), !1
}), $(".number_up").click(function () {
    var e = $("input.product-quantity");
    return e.val(parseInt(e.val()) + 1), e.change(), !1
});
var skuid = $("#product-skus input:radio:checked").data("sku-id");
$("#artsku").text(skuid);
var cur_elem_name = $("#product-skus input:radio:checked").parent("#product-skus > li > label"), notcur_elem_name = $("#product-skus input:radio:not(:checked)").parent("#product-skus > li > label");
$(cur_elem_name).find(".sku_total").css("border", "2px solid #f4731e"), $(notcur_elem_name).find(".sku_total").css("border", "2px solid white"), $("input[name=sku_id]:radio:checked").data("disabled") && $(".product-submit").val("Нет в наличии"), $("input[name=sku_id]:radio").change(function () {
    $(".product-submit").val($(this).data("disabled") ? "Нет в наличии" : "В корзину")
}), $(function () {
    function e(e, t) {
        if (void 0 === e)if ($("#product-skus input:radio:checked").length) {
            var e = parseFloat($("#product-skus input:radio:checked").data("price"));
            if (void 0 === t)var t = parseFloat($("#product-skus input:radio:checked").data("compare-price"))
        } else var e = parseFloat($(".add2cart .price").data("price"));
        var a = $("#product-skus input:radio:checked").data("sku-id");
        $("#artsku").text(a), t ? ($(".add2cart .compare-at-price").length || $(".add2cart").prepend('<span class="compare-at-price nowrap"></span>'), $(".add2cart .compare-at-price").html(currency_format(t, 1)).show()) : $(".add2cart .compare-at-price").hide(), $("#cart-form .services input:checked").each(function () {
            var t = $(this).val();
            e += parseFloat($("#service-" + t + "  .service-variants").length ? $("#service-" + t + "  .service-variants :selected").data("price") : $(this).data("price"))
        }), $(".add2cart .price").html(currency_format(e, 1))
    }

    var t = function (e, t, a) {
        return '<option data-price="' + a + '" id="service-variant-' + e + '" value="' + e + '">' + t + " (+" + currency_format(a, 1) + ")</option>"
    }, a = function (e) {
        $("div.stocks div").hide(), $("#sku-" + e + "-stock").show();
        for (var a in sku_services[e]) {
            var i = sku_services[e][a];
            if (i === !1)$("#service-" + a).hide().find("input,select").attr("disabled", "disabled").removeAttr("checked"); else if ($("#service-" + a).show().find("input").removeAttr("disabled"), "string" == typeof i)$("#service-" + a + " .service-price").html(currency_format(i, 1)), $("#service-" + a + " input").data("price", i); else {
                var r = $("#service-" + a + " .service-variants").data("variant-id");
                for (var c in i) {
                    var s = $("#service-variant-" + c);
                    i[c] === !1 ? s.hide() : (r || (r = c), s.replaceWith(t(c, i[c][0], i[c][1])))
                }
                $("#service-" + a + " .service-variants").val(r)
            }
        }
    };
    $("#product-skus input:radio").click(function () {
        if ($(this).data("image-id")) {
            var t = $("#product-image-" + $(this).data("image-id")).attr("href"), i = $("#product-image-" + $(this).data("image-id")).data("small");
            console.log($("#product-image-" + $(this).data("image-id"))), $("#image-link").attr("href", t), $("#product-image").attr("src", i)
        }
        var r = $("#product-skus input:radio:checked").parent("#product-skus > li > label"), c = $("#product-skus input:radio:not(:checked)").parent("#product-skus > li > label");
        $(r).find(".sku_total").css("border", "2px solid #f4731e"), $(c).find(".sku_total").css("border", "2px solid white"), $(this).data("disabled") ? $(".add2cart input:submit").attr("disabled", "disabled") : $(".add2cart input:submit").removeAttr("disabled");
        var s = $(this).val();
        a(s), e()
    }), $("select.sku-feature").change(function () {
        var t = "";
        $("select.sku-feature").each(function () {
            t += $(this).data("feature-id") + ":" + $(this).val() + ";"
        });
        var i = sku_features[t];
        if (i) {
            if (i.image_id) {
                $("#product-image").parent().find("div.loading").remove(), $("#product-image").parent().append('<div class="loading" style="position: absolute; left: ' + ($("#product-image").width() - 16) / 2 + "px; top: " + ($("#product-image").height() - 16) / 2 + 'px"><i class="icon16 loading"></i></div>');
                var r = $("#product-image-" + i.image_id + " img"), c = $("#product-image").attr("src").replace(/^.*\/[0-9]+\.(.*)\..*$/, "$1"), s = r.attr("src").replace(/^(.*\/[0-9]+\.)(.*)(\..*)$/, "$1" + c + "$3"), d = $("#product-image-" + i.image_id), o = $("#image-link").attr("href").replace(/^.*\/[0-9]+\.(.*)\..*$/, "$1"), n = d.attr("href").replace(/^(.*\/[0-9]+\.)(.*)(\..*)$/, "$1" + o + "$3");
                $("<img>").attr("src", s).load(function () {
                    $("#product-image").attr("src", s), $("#image-link").attr("href", n), $("#product-image").parent().find("div.loading").remove()
                }).each(function () {
                    this.complete && $(this).trigger("load")
                })
            }
            a(i.id), i.available ? $(".add2cart input[type=submit]").removeAttr("disabled") : $(".add2cart input[type=submit]").attr("disabled", "disabled"), $(".add2cart .price").data("price", i.price), e(i.price, i.compare_price)
        } else $("div.stocks div").hide(), $("#sku-no-stock").show(), $(".add2cart input[type=submit]").attr("disabled", "disabled"), $(".add2cart .compare-at-price").hide(), $(".add2cart .price").empty()
    }), $("select.sku-feature:first").change(), $("#product-skus input:radio:checked").length || $("#product-skus input:radio:enabled:first").attr("checked", "checked"), $("#product-gallery a").hover(function () {
        $("#product-image").parent().find("div.loading").remove(), $("#product-image").parent().append('<div class="loading" style="position: absolute; left: ' + ($("#product-image").width() - 16) / 2 + "px; top: " + ($("#product-image").height() - 16) / 2 + 'px"><i class="icon16 loading"></i></div>');
        var e = $(this).find("img"), t = $("#product-image").attr("src").replace(/^.*\/[0-9]+\.(.*)\..*$/, "$1"), a = e.attr("src").replace(/^(.*\/[0-9]+\.)(.*)(\..*)$/, "$1" + t + "$3");
        return $("<img>").attr("src", a).load(function () {
            $("#product-image").attr("src", a), $("#product-image").parent().find("div.loading").remove()
        }).each(function () {
            this.complete && $(this).trigger("load")
        }), !1
    }), $(".cart .services input:checkbox").click(function () {
        var t = $('select[name="service_variant[' + $(this).val() + ']"]');
        t.length && ($(this).is(":checked") ? t.removeAttr("disabled") : t.attr("disabled", "disabled")), e()
    }), $(".cart .services .service-variants").on("change", function () {
        e()
    }), $("a.compare-add").click(function () {
        var e = $.cookie("shop_compare");
        if (e ? e += "," + $(this).data("product") : e = "" + $(this).data("product"), e.split(",").length > 1) {
            var t = $("#compare-link").attr("href").replace(/compare\/.*$/, "compare/" + e + "/");
            $("#compare-link").attr("href", t).show().find("span.count").html(e.split(",").length)
        }
        return $.cookie("shop_compare", e, {expires: 30, path: "/"}), $(this).hide(), $("a.compare-remove").show(), !1
    }), $("a.compare-remove").click(function () {
        var e = $.cookie("shop_compare");
        e = e ? e.split(",") : [];
        var t = $.inArray($(this).data("product") + "", e);
        return -1 != t && e.splice(t, 1), $("#compare-link").hide(), e ? $.cookie("shop_compare", e.join(","), {
            expires: 30,
            path: "/"
        }) : $.cookie("shop_compare", null), $(this).hide(), $("a.compare-add").show(), !1
    }), $("#cart-form").submit(function () {
        var e = $(this);
        return $.post(e.attr("action") + "?html=0", e.serialize(), function (t) {
            if ("ok" == t.status) {
                var a = $(".cart-total"), i = $(".cart-count"), r = e.closest(".cart");
                a.closest(".cart").removeClass("empty"), $(window).scrollTop() >= 45 && $("#cart-summary").addClass("fixed");
                var c = $('<div class="cart"></div>').append($("#cart-form").clone());
                r.closest("#dialog").length ? (console.log("true"), c.insertAfter(r.closest("#dialog"))) : (console.log("false"), c.insertAfter(r)), c.css({
                    "z-index": 10,
                    top: r.offset().top,
                    left: r.offset().left,
                    width: r.width() + "px",
                    height: r.height() + "px",
                    position: "absolute",
                    overflow: "hidden"
                }).insertAfter("#main").animate({
                    top: a.offset().top,
                    left: a.offset().left,
                    width: 0,
                    height: 0,
                    opacity: .5
                }, 500, function () {
                    $(this).remove(), a.html(t.data.total), i.html(t.data.count)
                }), r.closest(".dialog").length && r.closest(".dialog").hide().find(".cart").empty()
            } else"fail" == t.status && alert(t.errors)
        }, "json"), !1
    })
});