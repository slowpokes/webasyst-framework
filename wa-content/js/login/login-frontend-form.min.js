var WaLoginAbstractForm=function(t){var r=function(){},e=r;e.className="WaLoginAbstractForm",e.def=function(t,r){for(var e=0,o=arguments.length;e<o;e++)if(void 0!==arguments[e])return arguments[e]};var o=e.def;return e.inherit=function(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t},e.prototype.init=function(t){var r=this;r.initVars(t),r.initSubmit(),r.initErrorsAutoCleaner(),r.showErrors(r.errors),r.setFocus(),r.initCaptcha()},e.prototype.initVars=function(r){var n=this;r=r||{},n.$wrapper=o(n.$wrapper,r.$wrapper,t()),n.$form||(n.$form=n.$wrapper.find(".js-wa-form-item"),n.$form.length||(n.$form=n.$wrapper.find("form")),n.$form.length||(n.$form=t())),n.namespace=o(n.namespace,r.namespace,""),n.$templates=o(n.$templates,r.$templates,{}),n.$templates=t.extend({error_msg:t('<em class="wa-error-msg"></em>'),info_msg:t('<div class="wa-info-msg"></div>')},n.$templates),n.classes=o(n.classes,r.classes,{}),n.classes=t.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},n.classes),n.errors=o(n.errors,r.errors,{}),n.is_errors=!t.isEmptyObject(n.errors),n.locale=o(n.locale,r.locale,{}),n.js_validate=o(n.js_validate,r.js_validate,!0),n.is_json_mode=o(n.is_json_mode,r.is_json_mode),n.className=o(n.className,e.className),n.$captcha=o(n.$captcha,n.$wrapper.find(".wa-captcha-field")),n.need_redirects=void 0===r.need_redirects||!!r.need_redirects,n.env="",n.form_type=""},e.prototype.getFormItem=function(){return this.$form},e.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},e.prototype.getSerializedFormData=function(){var t=this,r=t.getFormItem();return r.is("form")?r.serializeArray():(r.find("[data-turn-off=1]").find(":input").attr("disabled",!0),r.find(":input:not(:disabled)").serializeArray())},e.prototype.beforeSubmit=function(){var t=this,r=t.getFormItem(),e=function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""};r.find('[name="_csrf"]').val(e)},e.prototype.setFocus=function(){},e.prototype.triggerEvent=function(t){var r=this,e={env:r.env,form_type:r.form_type,form_wrapper_id:r.$wrapper.attr("id")},o=Array.prototype.slice.call(arguments),o=o.slice(1);r.$wrapper.trigger(t,o.concat([e]))},e.prototype.initCaptcha=function(){var r=this;r.$wrapper.find(".wa-captcha-field").length?t(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view")}):r.triggerEvent("wa_auth_form_loaded")},e.prototype.turnOffBlock=function(r){var e=this;r.data("turnOff",1).attr("data-turn-off",1).hide(),r.find(":input").attr("disabled",!0),r.find("[type=button],:submit").each(function(){var r=t(this),o=t('<div class="wa-js-old-button-place"></div>'),n=t('<div class="wa-js-new-button-place"></div>');r.after(o),o.data("button",r),n.hide(),e.getFormItem().append(n),n.html(r)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.turnOnBlock=function(r){var e=this;r.find(".wa-js-old-button-place").each(function(){var r=t(this),e=r.data("button"),o=e.parent();r.after(e),r.remove(),o.remove()}),r.data("turnOff","").attr("data-turn-off","").show(),r.find(":input").attr("disabled",!1),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.formatInfoMessage=function(r,e,o){e=void 0===e||e;var n=this,a=n.$templates.info_msg,i=a.clone();return void 0!==o&&i.data("name",o).attr("data-name",o),e?i.text(t.trim(""+r)):i.html(t.trim(""+r))},e.prototype.getInfoMessages=function(t){var r=this,e=r.$wrapper,o="."+r.classes.message_msg;return t&&(o+='[data-name="'+t+'"]'),e.find(o)},e.prototype.clearInfoMessages=function(t){var r=this;r.getInfoMessages(t).remove(),r.triggerEvent("wa_auth_form_change_view")},e.prototype.showInfoMessages=function(r){var e=this,o=e.$wrapper,n=o.find("."+e.classes.messages);t.each(r||{},function(r,o){var a=e.getFormInput(r);"string"==typeof o&&(o=[o]);var i=[];t.each(o||[],function(t,o){var n=e.formatInfoMessage(o,!1,r);n.data("code",t).attr("data-code",t),i.push(n)}),a.length?a.after(i):n.show().append(i)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.clearErrors=function(){var t=this;if(t.is_errors){var r=t.$wrapper;r.find("."+t.classes.error_input).removeClass(t.classes.error_input),r.find("."+t.classes.error_msg).not("[data-not-clear=1]").remove(),r.find("."+t.classes.uncaught_errors).find("."+t.classes.error_msg).length<=0&&r.find("."+t.classes.uncaught_errors).hide(),t.is_errors=!1,t.triggerEvent("wa_auth_form_change_view")}},e.prototype.getErrorTemplate=function(t,r,e){return this.$templates.error_msg},e.prototype.escape=function(r){var e=t("<div>");return e.text(t.trim(""+r)),r=e.text(),e.remove(),r},e.prototype.prepareErrorText=function(t,r,e){return this.escape(r)},e.prototype.prepareErrorItem=function(t,r,e){var o=this,n=o.getErrorTemplate(t,r,e).clone(),a=n.clone();return a.data("name",t).data("code",e).attr("data-name",t).attr("data-code",e),a.html(o.prepareErrorText(t,r,e)),a},e.prototype.showInputError=function(t,r){var e=this,o=e.getFormInput(t);return!!o.length&&(o.parent().append(r),o.addClass(e.classes.error_input),!0)},e.prototype.getFormInput=function(t){var r=this,e=r.getFormItem(),o=r.buildFormInputName(t);return e.find('[name="'+o+'"]')},e.prototype.buildFormInputName=function(t){var r=this,e=r.namespace;return e?e+"["+t+"]":t},e.prototype.getFormField=function(t){var r=this;return r.$wrapper.find("."+r.classes.field+'[data-field-id="'+t+'"]')},e.prototype.getInfoMessageItem=function(t,r){var e=this,o=e.$wrapper,n=o.find("."+e.classes.message_msg+'[data-name="'+t+'"]');return void 0!==r?n.filter('[data-code="'+r+'"]'):n},e.prototype.getErrorItem=function(t,r){var e=this,o=e.$wrapper,n=o.find("."+e.classes.error_msg+'[data-name="'+t+'"]');return void 0!==r?n.filter('[data-code="'+r+'"]'):n},e.prototype.showUncaughtErrors=function(t,r,e){var o=this,n=o.$wrapper,a=n.find("."+o.classes.uncaught_errors);return!!a.length&&(a.show(),e&&a.html(""),a.show().append(r),!0)},e.prototype.afterShowErrors=function(){},e.prototype.showErrors=function(r){var e=this;t.each(r||{},function(r,o){"string"==typeof o&&(o=[o]);var n=e.prepareErrorItems(r,o),a=e.showInputError(r,n);a||(a=e.showUncaughtErrors(r,n,!0)),!a&&console&&console.error&&t.each(n,function(){var r="Uncaught validate error: "+t(this).text();console.error(r)})}),e.is_errors=!0,e.afterShowErrors(),e.triggerEvent("wa_auth_form_change_view")},e.prototype.initSubmit=function(){var r=this,e=r.getFormItem(),o=null,n=function(t){var e=r.onSubmit(t);e&&(o&&o.abort(),o=e)};e.is("form")?e.submit(function(t){n(t)}):(e.on("click",":submit,button",function(r){var e=t(this);e.is(":disabled")||e.data("ignore")||(r.preventDefault(),n(r))}),e.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),e.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},e.prototype.validate=function(){return{}},e.prototype.initErrorsAutoCleaner=function(){var r=this,e=r.getFormItem(),o={},n=r.buildFormInputName("captcha"),a=":text:not([name="+n+"]),:password";e.find(a).each(function(){var r=t(this),e=r.attr("name"),n=r.val();o[e]={val:t.trim(n||""),timer:null}}),e.on("keydown",a,function(e){if(13!=e.keyCode){var n=t(this),a=n.attr("name"),i=o[a]||{},s=t.trim(i.val||""),p=i.timer||null;p&&clearTimeout(p),i.timer=setTimeout(function(){var e=t.trim(n.val()||"");e!==s&&r.clearErrors(),i.val=e},300)}}),e.on("change",":input",function(){var e=t(this),n=e.attr("name"),a=o[n]||{},i=t.trim(a.val||""),s=t.trim(e.val()||"");s!==i&&r.clearErrors(),a.val=s})},e.prototype.onDoneSubmitHandlers=function(){var t=this;return{errors:function(r,e){return t.showErrors(r),!0},redirect:function(t){return t=t||"",-1!==t.indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(r){return t.showInfoMessages(r),!0},rest:function(t){return!0}}},e.prototype.onDoneSubmit=function(r){var e=this,o=e.onDoneSubmitHandlers(),n=r&&"ok"===r.status,a=r&&r.data||{},i=a.messages||{},s=r&&r.errors||{};if(n||!(o.errors&&o.errors(s,r))){if(e.isRedirectResponse(r)){var p=e.getRedirectUrl(r);if(o.redirect&&o.redirect(p,r))return}!t.isEmptyObject(i)&&(o.messages&&o.messages(i,r))||o.rest&&o.rest(r)}},e.prototype.submit=function(r){r=r||{};var e=this;if(e.beforeSubmit(),e.clearErrors(),e.js_validate){var o=e.validate();if(!t.isEmptyObject(o))return void e.showErrors(o)}var n=e.getFormItem(),a=r.$button||n.find(":submit"),i=r.$loading||n.find(".wa-loading"),s=r.url||e.getFormAction(),p=e.getSerializedFormData();return i.show(),a.attr("disabled",!0),e.jsonPost(s,p).done(function(t){e.isRedirectResponse(t)||(a.attr("disabled",!1),i.hide()),e.onDoneSubmit(t)}).fail(function(){a.attr("disabled",!1)})},e.prototype.onSubmit=function(t){var r=this;if(r.isJsonMode())return t.preventDefault(),r.submit()},e.prototype.mixinVarsInData=function(r,e){return t.isPlainObject(e)?e=t.extend(e,r):t.isArray(e)?t.each(r,function(t,r){e.push({name:t,value:r})}):e&&t.each(r,function(t,r){e+="&"+t+"="+r}),e},e.prototype.beforeJsonPost=function(t,r){var e=this,o={wa_json_mode:1,need_redirects:e.need_redirects?1:0};return r=e.mixinVarsInData(o,r)},e.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},e.prototype.getRedirectUrl=function(t){var r=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof r?r:null},e.prototype.jsonPost=function(r,e){var o=this;return e=o.beforeJsonPost(r,e),t.post(r,e,"json").always(function(r){o.isRedirectResponse(r)||t(".wa-captcha-refresh").trigger("click")})},e.prototype.beforeErrorTimerStart=function(t,r,e){},e.prototype.afterErrorTimerFinish=function(t,r,e){},e.prototype.prepareTimeoutErrorItem=function(t,r,e){var o=this,n=o.prepareErrorItem("timeout",t);return e=e||{},o.beforeErrorTimerStart(t,r,e),n.data("notClear",1).attr("data-not-clear",1),o.runTimeoutMessage(n,{timeout:r,onFinish:function(){n.remove(),o.afterErrorTimerFinish(t,r,e)}}),n},e.prototype.prepareErrorItems=function(r,e){var o=this,n=[];if("timeout"===r){var a=e.message,i=e.timeout,s=o.prepareTimeoutErrorItem(a,i,{error_namespace:r});n=[s]}else t.each(e||[],function(t,e){var a;a="timeout"===t?o.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):o.prepareErrorItem(r,e,t),n.push(a)});return n},e.prototype.runTimeoutMessage=function(r,e){var o=this,n=e.timeout,a=t.trim(r.html()),i=e.onFinish;if(n=parseInt(n,10),n=!isNaN(n)&&n>0?n:60,i="function"==typeof i?i:null,a.match(/\d+:\d/)){o.triggerEvent("wa_auth_form_change_view");var s=setInterval(function(){if((n-=1)<=0)return clearInterval(s),r.remove(),void(i&&i());var t=r.html(),e=parseInt(n/60,10),o=n%60,a=e<=9?"0"+e:e,p=o<=9?"0"+o:o;t=t.replace(/\d+:\d+/,a+":"+p),r.html(t)},1e3)}},e}(jQuery),WaLoginAbstractLoginForm=function(t){var r=WaLoginAbstractLoginForm=function(){};r.className="WaLoginAbstractLoginForm";var e=WaLoginAbstractForm,o=WaLoginAbstractForm.def;return r.prototype=Object.create(e.prototype),r.prototype.constructor=r,r.prototype.init=function(t){var r=this;e.prototype.init.call(r,t)},r.prototype.initVars=function(t){var n=this;t=t||{},n.auth_type=o(n.auth_type,t.auth_type,""),n.className=o(n.className,r.className),e.prototype.initVars.call(n,t),n.timeout=o(n.timeout,0),n.timeout=isNaN(n.timeout)||n.timeout<=0?60:n.timeout,n.form_type="login"},r.prototype.setFocus=function(){var r=this,e=r.getFormInput("login"),o=r.getFormInput("password");t.trim(e.val()||"")?o.focus():e.focus()},r.prototype.validate=function(r){var e=this,o=e.getSerializedFormData(),n={};return t.each(o,function(o,a){var i=a.name,s=t.trim(a.value||"");i!==e.buildFormInputName("login")||s||(n.login=[e.locale.login_required||e.locale.required||""]),i!==e.buildFormInputName("captcha")||s||(n.captcha=[e.locale.captcha_required||e.locale.required||""]),r||i!==e.buildFormInputName("password")||s||(n.password=[e.locale.password_required||e.locale.required||""])}),n},r.prototype.prepareErrorItem=function(t,r,o){var n=this,a=e.prototype.prepareErrorItem.call(n,t,r,o);if(n.isOneTimePasswordMode()&&"password"===t&&"out_of_tries"===o){var i=n.getFormInput("password"),s=n.getFormItem();i.attr("readonly",!0),s.find(".wa-login-submit").attr("disabled",!0)}return a},r.prototype.isOneTimePasswordMode=function(){return"onetime_password"===this.auth_type},r.prototype.onSentOnetimePassword=function(t){var r=this;t=t||{},r.showInfoMessages(t.messages||{})},r.prototype.initOnetimePasswordLink=function(r){var e=this,r=r||{},o=r.$link,n=r.$loading;if(o.length&&e.isOneTimePasswordMode()){var a=null;o.data("ignore","1"),o.on("click",function(r){if(r.preventDefault(),e.clearErrors(),e.js_validate){var i=e.validate(!0);if(!t.isEmptyObject(i))return void e.showErrors(i)}if(!a){var s=o.attr("href")||o.data("href");n.show(),o.attr("disabled",!0);var p=e.getSerializedFormData();e.clearErrors(),a=e.jsonPost(s,p).done(function(t){o.attr("disabled",!1),t&&"ok"===t.status?e.onSentOnetimePassword(t.data):e.showErrors(t?t.errors||{}:{})}).fail(function(){o.attr("disabled",!1)}).always(function(){a=null,n.hide()})}})}},r}(jQuery),WaFrontendLogin=function(t){var r=function(t){this.init(t)},e=r;e.className="WaFrontendLogin";var o=WaLoginAbstractLoginForm;return e.prototype=Object.create(o.prototype),e.prototype.constructor=e,e.prototype.init=function(t){var r=this;o.prototype.init.call(r,t),r.initView()},e.prototype.initVars=function(r){var n=this;r=r||{},n.$templates={confirm_email_error:t('<div class="wa-error-msg wa-confirm-email-error"></div>')},n.classes={field:"wa-field"},o.prototype.initVars.call(n,r),n.className=e.className,n.is_onetime_password_auth_type=r.is_onetime_password_auth_type||!1,n.env="frontend",n.is_need_confirm=r.is_need_confirm||!1},e.prototype.initView=function(){var t=this;t.isOneTimePasswordMode()&&t.initOnetimePasswordView(),t.isNeedConfirm()&&t.initConfirmView(),t.initAuthAdapters()},e.prototype.initAuthAdapters=function(){function r(t){if(t.data("id")){var r=(screen.width-600)/2,e=(screen.height-400)/2,o=t.attr("href");window.open(o,"oauth","width=600,height=400,left="+r+",top="+e+",status=no,toolbar=no,menubar=no")}}var e=this,o=e.$wrapper.find(".wa-adapters-section");if(!o.length)return!1;o.on("click","a",function(e){e.preventDefault(),r(t(this))})},e.prototype.isNeedConfirm=function(){return this.is_need_confirm},e.prototype.initConfirmView=function(){var t=this,r=t.$wrapper,e=r.find(".wa-edit-login-link-wrapper"),o=r.find(".wa-send-again-confirmation-code-link-wrapper"),n=r.find(".wa-signup-form-confirmation-block"),a=t.getFormInput("login");t.turnOffBlock(n),t.turnOffBlock(e),t.turnOffBlock(o),e.click(function(){t.turnOffBlock(n),a.removeAttr("readonly");var r=t.getFormItem(),e=r.find(":submit:first:not(:disabled)");if(!e.length){e=r.find(":submit:first"),e.attr("disabled",!1);t.getFormInput("confirmation_code").removeAttr("readonly").val("")}}),o.click(function(){t.turnOffBlock(n);var r=t.getFormItem(),e=r.find(":submit:first:not(:disabled)");if(!e.length){e=r.find(":submit:first"),e.attr("disabled",!1);t.getFormInput("confirmation_code").removeAttr("readonly").val("")}e.trigger("click")})},e.prototype.initOnetimePasswordView=function(){var t=this,r=t.$wrapper,e=function(){t.turnOffBlock(r.find(".wa-buttons-wrapper")),t.turnOnBlock(r.find(".wa-request-onetime-password-button-wrapper")),t.turnOffBlock(t.getFormField("password")),r.find(".wa-send-again-onetime-password-link-wrapper").hide(),r.find(".wa-send-onetime-password-edit-link-wrapper").hide(),t.getFormInput("login").removeAttr("readonly")};e(),t.initOnetimePasswordLink({$link:r.find(".wa-request-onetime-password-button"),$loading:r.find(".wa-request-onetime-password-button-loading")}),t.initOnetimePasswordLink({$link:r.find(".wa-send-again-onetime-password-link"),$loading:r.find(".wa-send-again-onetime-password-link-loading")}),r.on("click",".wa-send-onetime-password-edit-link",function(){e()})},e.prototype.onSentOnetimePassword=function(t){var r=this,e=r.$wrapper;t=t||{},"email"===t.used_channel_type?e.find(".wa-onetime-password-transport-message").html(r.locale.sent_by_email||""):"sms"===t.used_channel_type&&e.find(".wa-onetime-password-transport-message").html(r.locale.sent_by_sms||"");var o=r.formatInfoMessage(t.onetime_password_timeout_message,!1,"timeout");e.find(".wa-onetime-password-input-message").html(o);var n=r.getFormField("password"),a=r.getFormInput("password");r.turnOnBlock(n),a.removeAttr("readonly").val(""),r.turnOnBlock(e.find(".wa-buttons-wrapper")),r.turnOffBlock(e.find(".wa-request-onetime-password-button-wrapper")),r.getFormInput("login").attr("readonly",1);var i=e.find(".wa-send-again-onetime-password-link-wrapper").hide(),s=e.find(".wa-send-onetime-password-edit-link-wrapper").hide();r.runTimeoutMessage(o,{timeout:t.onetime_password_timeout,onFinish:function(){i.show(),s.show()}})},e.prototype.prepareErrorText=function(r,e,n){var a=this;return"login"===r&&"confirm_email"===n||"confirm_email"===r?t.trim(e||""):o.prototype.prepareErrorText.apply(a,arguments)},e.prototype.getErrorTemplate=function(t,r,e){var n=this;return"login"===t&&"confirm_email"===e||"confirm_email"===t?n.$templates.confirm_email_error:o.prototype.getErrorTemplate.apply(n,arguments)},e.prototype.prepareErrorItem=function(r,e,n){var a,i=this;if("login"===r&&"confirm_email"===n||"confirm_email"===r){var s=":ERROR-"+(""+Math.random()).slice(2)+":";a=o.prototype.prepareErrorItem.call(i,r,s,n),a.attr("data-not-clear","1");var p=t("<div>").append(a),c=p.html();return c=c.replace(s,e),i.getErrorItem(r,n).remove(),c}if(a=o.prototype.prepareErrorItem.call(i,r,e,n),"confirmation_code"===r&&"out_of_tries"===n){var m=i.getFormInput("confirmation_code"),u=i.getFormItem();return m.attr("readonly",!0),u.find(".wa-login-submit").attr("disabled",!0),a}return a},e.prototype.hideOauthAdaptersBlock=function(){this.$wrapper.find(".wa-adapters-section").hide()},e.prototype.beforeJsonPost=function(t,r){var e=this;return e.hideOauthAdaptersBlock(),o.prototype.beforeJsonPost.call(e,t,r)},e.prototype.beforeErrorTimerStart=function(t,r,e){var n=this;if(o.prototype.beforeErrorTimerStart(t,r,e),"confirmation_code"===e.error_namespace){n.getFormInput("confirmation_code").attr("readonly",1)}},e.prototype.afterErrorTimerFinish=function(t,r,e){var n=this;if(o.prototype.afterErrorTimerFinish(t,r,e),"confirmation_code"===e.error_namespace){n.getFormInput("confirmation_code").removeAttr("readonly")}},e.prototype.onConfirmPhoneError=function(t){var r=this,e=r.$wrapper,o=e.find(".wa-edit-login-link-wrapper"),n=e.find(".wa-send-again-confirmation-code-link-wrapper"),a=e.find(".wa-signup-form-confirmation-block"),i=r.getFormInput("login");r.turnOnBlock(a),i.attr("readonly",1);var s=t.data;if(s.code_sent){var p=r.formatInfoMessage(s.code_sent_timeout_message,!1,"timeout");e.find(".wa-confirmation-code-input-message").html(p),n.hide(),o.hide(),r.runTimeoutMessage(p,{timeout:s.code_sent_timeout,onFinish:function(){n.show(),o.show()}})}},e.prototype.onDoneSubmitHandlers=function(){var r=this,e=o.prototype.onDoneSubmitHandlers.call(r);return e.errors=function(e,o){return t.isEmptyObject(e.confirmation_code)||r.onConfirmPhoneError(o),r.showErrors(e),!0},e.rest=function(t){"ok"===t.data.auth_status&&r.triggerEvent("wa_auth_contact_logged",t.data.contact||{})},e},e}(jQuery);
//# sourceMappingURL=login-frontend-form.min.js.map
