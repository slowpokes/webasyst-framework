var WaLoginAbstractForm=function(r){var t=function(){},e=t;e.className="WaLoginAbstractForm",e.def=function(r,t){for(var e=0,o=arguments.length;e<o;e++)if(void 0!==arguments[e])return arguments[e]};var o=e.def;return e.inherit=function(r,t){r.prototype=Object.create(t.prototype),r.prototype.constructor=r},e.prototype.init=function(r){var t=this;t.initVars(r),t.initSubmit(),t.initErrorsAutoCleaner(),t.showErrors(t.errors),t.setFocus(),t.initCaptcha()},e.prototype.initVars=function(t){var a=this;t=t||{},a.$wrapper=o(a.$wrapper,t.$wrapper,r()),a.$form||(a.$form=a.$wrapper.find(".js-wa-form-item"),a.$form.length||(a.$form=a.$wrapper.find("form")),a.$form.length||(a.$form=r())),a.namespace=o(a.namespace,t.namespace,""),a.$templates=o(a.$templates,t.$templates,{}),a.$templates=r.extend({error_msg:r('<em class="wa-error-msg"></em>'),info_msg:r('<div class="wa-info-msg"></div>')},a.$templates),a.classes=o(a.classes,t.classes,{}),a.classes=r.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},a.classes),a.errors=o(a.errors,t.errors,{}),a.is_errors=!r.isEmptyObject(a.errors),a.locale=o(a.locale,t.locale,{}),a.js_validate=o(a.js_validate,t.js_validate,!0),a.is_json_mode=o(a.is_json_mode,t.is_json_mode),a.className=o(a.className,e.className),a.$captcha=o(a.$captcha,a.$wrapper.find(".wa-captcha-field")),a.need_redirects=void 0===t.need_redirects||!!t.need_redirects,a.env="",a.form_type=""},e.prototype.getFormItem=function(){return this.$form},e.prototype.getFormAction=function(){var r=this;return r.$form.is("form")?r.$form.attr("action"):r.$form.data("action")},e.prototype.getSerializedFormData=function(){var r=this,t=r.getFormItem();return t.is("form")?t.serializeArray():(t.find("[data-turn-off=1]").find(":input").attr("disabled",!0),t.find(":input:not(:disabled)").serializeArray())},e.prototype.beforeSubmit=function(){var r=this,t=r.getFormItem(),e=function(){var r=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return r&&r[1]?decodeURIComponent(r[1]):""};t.find('[name="_csrf"]').val(e)},e.prototype.setFocus=function(){},e.prototype.triggerEvent=function(r){var t=this,e={env:t.env,form_type:t.form_type,form_wrapper_id:t.$wrapper.attr("id")},o=Array.prototype.slice.call(arguments),o=o.slice(1);t.$wrapper.trigger(r,o.concat([e]))},e.prototype.initCaptcha=function(){var t=this;t.$wrapper.find(".wa-captcha-field").length?r(window).one("wa_recaptcha_loaded wa_captcha_loaded",function(){t.triggerEvent("wa_auth_form_loaded"),t.triggerEvent("wa_auth_form_change_view")}):t.triggerEvent("wa_auth_form_loaded")},e.prototype.turnOffBlock=function(t){var e=this;t.data("turnOff",1).attr("data-turn-off",1).hide(),t.find(":input").attr("disabled",!0),t.find("[type=button],:submit").each(function(){var t=r(this),o=r('<div class="wa-js-old-button-place"></div>'),a=r('<div class="wa-js-new-button-place"></div>');t.after(o),o.data("button",t),a.hide(),e.getFormItem().append(a),a.html(t)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.turnOnBlock=function(t){var e=this;t.find(".wa-js-old-button-place").each(function(){var t=r(this),e=t.data("button"),o=e.parent();t.after(e),t.remove(),o.remove()}),t.data("turnOff","").attr("data-turn-off","").show(),t.find(":input").attr("disabled",!1),e.triggerEvent("wa_auth_form_change_view")},e.prototype.isJsonMode=function(){return this.is_json_mode},e.prototype.formatInfoMessage=function(t,e,o){e=void 0===e||e;var a=this,n=a.$templates.info_msg,i=n.clone();return void 0!==o&&i.data("name",o).attr("data-name",o),e?i.text(r.trim(""+t)):i.html(r.trim(""+t))},e.prototype.getInfoMessages=function(r){var t=this,e=t.$wrapper,o="."+t.classes.message_msg;return r&&(o+='[data-name="'+r+'"]'),e.find(o)},e.prototype.clearInfoMessages=function(r){var t=this;t.getInfoMessages(r).remove(),t.triggerEvent("wa_auth_form_change_view")},e.prototype.showInfoMessages=function(t){var e=this,o=e.$wrapper,a=o.find("."+e.classes.messages);r.each(t||{},function(t,o){var n=e.getFormInput(t);"string"==typeof o&&(o=[o]);var i=[];r.each(o||[],function(r,o){var a=e.formatInfoMessage(o,!1,t);a.data("code",r).attr("data-code",r),i.push(a)}),n.length?n.after(i):a.show().append(i)}),e.triggerEvent("wa_auth_form_change_view")},e.prototype.clearErrors=function(){var r=this;if(r.is_errors){var t=r.$wrapper;t.find("."+r.classes.error_input).removeClass(r.classes.error_input),t.find("."+r.classes.error_msg).not("[data-not-clear=1]").remove(),t.find("."+r.classes.uncaught_errors).find("."+r.classes.error_msg).length<=0&&t.find("."+r.classes.uncaught_errors).hide(),r.is_errors=!1,r.triggerEvent("wa_auth_form_change_view")}},e.prototype.getErrorTemplate=function(r,t,e){return this.$templates.error_msg},e.prototype.escape=function(t){var e=r("<div>");return e.text(r.trim(""+t)),t=e.text(),e.remove(),t},e.prototype.prepareErrorText=function(r,t,e){return this.escape(t)},e.prototype.prepareErrorItem=function(r,t,e){var o=this,a=o.getErrorTemplate(r,t,e).clone(),n=a.clone();return n.data("name",r).data("code",e).attr("data-name",r).attr("data-code",e),n.html(o.prepareErrorText(r,t,e)),n},e.prototype.showInputError=function(r,t){var e=this,o=e.getFormInput(r);return!!o.length&&(o.parent().append(t),o.addClass(e.classes.error_input),!0)},e.prototype.getFormInput=function(r){var t=this,e=t.getFormItem(),o=t.buildFormInputName(r);return e.find('[name="'+o+'"]')},e.prototype.buildFormInputName=function(r){var t=this,e=t.namespace;return e?e+"["+r+"]":r},e.prototype.getFormField=function(r){var t=this;return t.$wrapper.find("."+t.classes.field+'[data-field-id="'+r+'"]')},e.prototype.getInfoMessageItem=function(r,t){var e=this,o=e.$wrapper,a=o.find("."+e.classes.message_msg+'[data-name="'+r+'"]');return void 0!==t?a.filter('[data-code="'+t+'"]'):a},e.prototype.getErrorItem=function(r,t){var e=this,o=e.$wrapper,a=o.find("."+e.classes.error_msg+'[data-name="'+r+'"]');return void 0!==t?a.filter('[data-code="'+t+'"]'):a},e.prototype.showUncaughtErrors=function(r,t,e){var o=this,a=o.$wrapper,n=a.find("."+o.classes.uncaught_errors);return!!n.length&&(n.show(),e&&n.html(""),n.show().append(t),!0)},e.prototype.afterShowErrors=function(){},e.prototype.showErrors=function(t){var e=this;r.each(t||{},function(t,o){"string"==typeof o&&(o=[o]);var a=e.prepareErrorItems(t,o),n=e.showInputError(t,a);n||(n=e.showUncaughtErrors(t,a,!0)),!n&&console&&console.error&&r.each(a,function(){var t="Uncaught validate error: "+r(this).text();console.error(t)})}),e.is_errors=!0,e.afterShowErrors(),e.triggerEvent("wa_auth_form_change_view")},e.prototype.initSubmit=function(){var t=this,e=t.getFormItem(),o=null,a=function(r){var e=t.onSubmit(r);e&&(o&&o.abort(),o=e)};e.is("form")?e.submit(function(r){a(r)}):(e.on("click",":submit,button",function(t){var e=r(this);e.is(":disabled")||e.data("ignore")||(t.preventDefault(),a(t))}),e.on("keydown","input",function(r){13==r.keyCode&&(r.preventDefault(),e.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},e.prototype.validate=function(){return{}},e.prototype.initErrorsAutoCleaner=function(){var t=this,e=t.getFormItem(),o={},a=t.buildFormInputName("captcha"),n=":text:not([name="+a+"]),:password";e.find(n).each(function(){var t=r(this),e=t.attr("name"),a=t.val();o[e]={val:r.trim(a||""),timer:null}}),e.on("keydown",n,function(e){if(13!=e.keyCode){var a=r(this),n=a.attr("name"),i=o[n]||{},s=r.trim(i.val||""),c=i.timer||null;c&&clearTimeout(c),i.timer=setTimeout(function(){var e=r.trim(a.val()||"");e!==s&&t.clearErrors(),i.val=e},300)}}),e.on("change",":input",function(){var e=r(this),a=e.attr("name"),n=o[a]||{},i=r.trim(n.val||""),s=r.trim(e.val()||"");s!==i&&t.clearErrors(),n.val=s})},e.prototype.onDoneSubmitHandlers=function(){var r=this;return{errors:function(t,e){return r.showErrors(t),!0},redirect:function(r){return r=r||"",-1!==r.indexOf("#")&&r===window.location.href?window.location.reload():window.location.href=r,!0},messages:function(t){return r.showInfoMessages(t),!0},rest:function(r){return!0}}},e.prototype.onDoneSubmit=function(t){var e=this,o=e.onDoneSubmitHandlers(),a=t&&"ok"===t.status,n=t&&t.data||{},i=n.messages||{},s=t&&t.errors||{};if(a||!(o.errors&&o.errors(s,t))){if(e.isRedirectResponse(t)){var c=e.getRedirectUrl(t);if(o.redirect&&o.redirect(c,t))return}!r.isEmptyObject(i)&&(o.messages&&o.messages(i,t))||o.rest&&o.rest(t)}},e.prototype.submit=function(t){t=t||{};var e=this;if(e.beforeSubmit(),e.clearErrors(),e.js_validate){var o=e.validate();if(!r.isEmptyObject(o))return void e.showErrors(o)}var a=e.getFormItem(),n=t.$button||a.find(":submit"),i=t.$loading||a.find(".wa-loading"),s=t.url||e.getFormAction(),c=e.getSerializedFormData();return i.show(),n.attr("disabled",!0),e.jsonPost(s,c).done(function(r){e.isRedirectResponse(r)||(n.attr("disabled",!1),i.hide()),e.onDoneSubmit(r)}).fail(function(){n.attr("disabled",!1)})},e.prototype.onSubmit=function(r){var t=this;if(t.isJsonMode())return r.preventDefault(),t.submit()},e.prototype.mixinVarsInData=function(t,e){return r.isPlainObject(e)?e=r.extend(e,t):r.isArray(e)?r.each(t,function(r,t){e.push({name:r,value:t})}):e&&r.each(t,function(r,t){e+="&"+r+"="+t}),e},e.prototype.beforeJsonPost=function(r,t){var e=this,o={wa_json_mode:1,need_redirects:e.need_redirects?1:0};return t=e.mixinVarsInData(o,t)},e.prototype.isRedirectResponse=function(r){return null!==this.getRedirectUrl(r)},e.prototype.getRedirectUrl=function(r){var t=r&&"ok"===r.status&&r.data&&r.data.redirect_url;return"string"==typeof t?t:null},e.prototype.jsonPost=function(t,e){var o=this;return e=o.beforeJsonPost(t,e),r.post(t,e,"json").always(function(t){o.isRedirectResponse(t)||r(".wa-captcha-refresh").trigger("click")})},e.prototype.beforeErrorTimerStart=function(r,t,e){},e.prototype.afterErrorTimerFinish=function(r,t,e){},e.prototype.prepareTimeoutErrorItem=function(r,t,e){var o=this,a=o.prepareErrorItem("timeout",r);return e=e||{},o.beforeErrorTimerStart(r,t,e),a.data("notClear",1).attr("data-not-clear",1),o.runTimeoutMessage(a,{timeout:t,onFinish:function(){a.remove(),o.afterErrorTimerFinish(r,t,e)}}),a},e.prototype.prepareErrorItems=function(t,e){var o=this,a=[];if("timeout"===t){var n=e.message,i=e.timeout,s=o.prepareTimeoutErrorItem(n,i,{error_namespace:t});a=[s]}else r.each(e||[],function(r,e){var n;n="timeout"===r?o.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:t,error_code:r}):o.prepareErrorItem(t,e,r),a.push(n)});return a},e.prototype.runTimeoutMessage=function(t,e){var o=this,a=e.timeout,n=r.trim(t.html()),i=e.onFinish;if(a=parseInt(a,10),a=!isNaN(a)&&a>0?a:60,i="function"==typeof i?i:null,n.match(/\d+:\d/)){o.triggerEvent("wa_auth_form_change_view");var s=setInterval(function(){if((a-=1)<=0)return clearInterval(s),t.remove(),void(i&&i());var r=t.html(),e=parseInt(a/60,10),o=a%60,n=e<=9?"0"+e:e,c=o<=9?"0"+o:o;r=r.replace(/\d+:\d+/,n+":"+c),t.html(r)},1e3)}},e}(jQuery),WaLoginAbstractSetPasswordForm=function(r){var t=WaLoginAbstractSetPasswordForm=function(){};t.className="WaLoginAbstractSetPasswordForm";var e=WaLoginAbstractForm,o=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(t,e),t.prototype.initVars=function(r){var a=this;a.className=o(a.className,t.className),e.prototype.initVars.call(a,r),a.form_type="setpassword"},t.prototype.validate=function(){var t=this,e=t.getSerializedFormData(),o={};r.each(e,function(e,a){var n=a.name,i=r.trim(a.value||"");return n!==t.buildFormInputName("login")||i?n!==t.buildFormInputName("password")||i?n!==t.buildFormInputName("captcha")||i?void 0:void(o.captcha=[t.locale.captcha_required||t.locale.required||""]):void(o.password=[t.locale.password_required||t.locale.required||""]):void(o.login=[t.locale.login_required||t.locale.required||""])});var a=t.getFormInput("password"),n=t.getFormInput("password_confirm");return r.trim(a.val()||"")!==r.trim(n.val()||"")&&(o.password_confirm=[t.locale.not_match||""]),o},t}(jQuery),WaBackendSetPassword=function(r){var t=function(r){this.init(r)},e=t;e.className="WaBackendSetPassword";var o=WaLoginAbstractSetPasswordForm;return WaLoginAbstractForm.inherit(e,o),e.prototype.initVars=function(r){var t=this;t.className=e.className,o.prototype.initVars.call(t,r),t.env="backend"},e}(jQuery);
//# sourceMappingURL=setpassword-backend-form.min.js.map
